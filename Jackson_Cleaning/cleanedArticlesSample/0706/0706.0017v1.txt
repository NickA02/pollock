 . A notation for parton showers . Structure of the calculation . The space of quantum parton states . The density matrix . Statistical states . The resolution scale . Parton shower evolution . Momentum and avor mapping . Splitting a nal state parton . Combining two nal state partons . The integration measure for nal state splitting . Splitting an initial state parton . Combining an initial state parton with a nal state parton . The integration measure for initial state splitting . Spin states . Splitting functions for the quantum states . Denition of the splitting functions vl . Initial state qq g splitting quark scatters . Initial state qq g splitting gluon scatters . Otherqqgsplittings . Splitting with a gggvertex . Soft splitting function . Description of color . Color basis . Parton insertion operators . Color evolution for the quantum states . Evolution for the statistical states . The operator HIt . Color evolution of the statistical states . Soft gluon coherence . Inclusive evolution . End of the shower . Conclusions A. Limit on momentum fraction after splitting B. Counting factors for the density matrix . Introduction Parton shower Monte Carlo event generators such as H ERWIG and P YTHIA have proven to be enormously useful since the development of the main ideas in the s . These computer programs perform calculations of cross sections according to an approximation to the standard model or some of its possible extensions. Because of the great success of these programs it is worthwhile to investigate possible improvements. In this paper we propose a theoretical structure for event generators that generalizes the structure of current programs and allows the elimination of certain approximations used currently. Parton showers are mostly re ections of QCD interactions. In order to present a reasonably complete discussion of the QCD issues in a parton shower while keeping the length of this paper within reasonable bounds we limit the presentation to QCD and omit any discussion of how electroweak and beyondthestandardmodel interactions are to be added to the QCD interactions to make a useful event generator. What is a parton shower Monte Carlo event generator Let us consider hadronhadron collisions which is the case relevant for the Tevatron and the Large Hadron Collider. An experiment will produce a large number of events f where one can characterize an event as a list of the momenta and avors of the nal state particles produced. The experiment can measure a cross section F corresponding to an observablethat assigns to each event f a numberFf. The relation of the cross section and the function Fis F LNX nFfn . whereLis the integrated luminosity for an experimental run and the fnare the observed events. For example the cross section to produce a Higgs boson and two jets having certain In order to be subject to reliable calculation in QCD perturbation theory the function Fshould have the property known as infrared safety. However a parton shower event generator is also useful for observables that are not infrared safe. characteristics is specied by setting Ff iffcontains a Higgs boson and two jets having these characteristics and Ff otherwise. A parton shower Monte Carlo event generator calculates this cross section by producing a large number Nof simulated events fn each with an accompanying weight wn. The calculated cross section is then F NNX nwnFfn . Most typically the weights are all equal so that wnis the simulated luminosity per point LN. Our denition of the category of parton shower Monte Carlo event generator includes the possibility that the weights are complex numbers produced for each event. It is always possible to throw away the imaginary parts of the wnsince we know in advance that the imaginary part of the sum in Eq. . vanishes so having complex weights is equivalent to having real weights that can be positive or negative. This situation occurs in typical event generators that are based on nexttoleading order perturbation theory. In a typical parton shower event generator the physics is modeled as a process in classical statistical mechanics. Some number of partons are produced in a hard interac tion. Then each parton has a chance to split into two partons with the probability to split determined from an approximation to the theory. Parton splitting continues in this probabilistic style until a complete parton shower has developed. The parton splitting probability is biggest when the two daughter partons are almost massless with nearly collinear momenta or when one of their momenta is soft near p or both. There is a simple underlying approximation used the amplitude for producing m partons when two of the momenta piandpjare nearly collinear or one is soft factors into a splitting function times the matrix element for producing mpartons. The underlying approximation is the factorization of amplitudes in the soft or collinear limits. However further approximations are usually added . The interference between a diagram in which a soft gluon is emitted from one hard parton and a diagram in which the same soft gluon is emitted from another hard parton is treated in an approximate way with the angular ordering approximation. . Color is treated in an approximate way valid when N c whereNc is the number of colors. . Parton spin is treated in an approximate way. According to the full quantum ampli tudes when a parton splits the angular distribution of the daughter partons depends on the mother parton spin and even on the interference between dierent mother parton spin states. This dependence is typically ignored. The case in which Ff takes values or is the most common but other possibilities are allowed. For instance the energyenergy correlation function in electronpositron annihilation is of the more general variety. The recent papers provide an exception to this rule. With the use of these further approximations one can get to a formalism in which the shower develops according to classical statistical mechanics with a certain evolution oper ator. Our purpose in this paper is to investigate whether one can have a formulation of parton showers based on the factorization of amplitudes in the soft or collinear limits in which one does not make the additional approximations enumerated above. For this one would have to use quantum statistical mechanics instead of classical statistical mechanics. It might seem that doing the problem in quantum mechanics is hopelessly complicated. However within the softcollinear factorization approximation the problem is fairly simple because it is almost classical. In fact if partons did not have color or spin the problem would be classical as we discuss in Sec. . Thus what we need is a fully quantum treatment of color and spin. We arrange for this by making use of the quantum density operator in color spin space. In the subsequent sections we dene evolution equations for the quantum density ma trix within the softcollinear factorization approximation. The matrix evolves in shower time from harder splittings to softer splittings. The iterative solution of these equations has the form familiar from parton showers with splitting functions and Sudakov exponen tials that express the probability for not splitting. There are however some dierences that result from not making the approximations and above. We also want to have a formulation that can coexist easily with matching the proba bilities generated by showering to known exact tree level matrix elements as in Refs. and with using nexttoleading order hard matrix elements as in Refs. . However we leave for future work the analysis of how one can match the showers to the exact tree level matrix elements or to nexttoleading order hard matrix elements. We pay particular attention to the kinematics. In the treatment here parton shower dynamics is represented in the splitting functions in the ordering of the hardness scales of successive branchings and in the kinematic mappings that dene the relation of the parton momenta before splitting to the momenta after splitting. Here we reversibly map mparton phase space into m parton phase space. This is not always the case in parton shower Monte Carlo event generators. We present a formalism for describing parton showers in which the result has the form of an integral equation for the evolution of the color spin density matrix. This integral equation can be solved iteratively. We do not however present an algorithm for generating a shower according to this equation. Just as there is more than one algorithm for performing a given integration numerically there is more than one way to implement the shower equations numerically. We leave issues of implementation for future work. One may wonder whether removing the approximations and listed above is numerically important. We do not know. What we would like to do is to set up a for malism that does not make approximations beyond the basic softcollinear factorization approximation then in future work implement this formalism as a working algorithm and computer code. One could then make the further approximations separately or all together and see what dierence they make. We close this introduction with some comments on whether a parton shower Monte Carlo event generator ought to allow weights for generated events and in particular nega tive weights. We rst note that in a real experiment the relation between the measurement function Fand the measured cross section is a little more complicated than we indicated in Eq. .. Instead we have F LNX n anFfn . whereLis the integrated luminosity for an experimental run in which Ntotal events n are collected and anis the acceptance for the event resulting from the way the detector is triggered. For example if a fraction of a certain kind of event is recorded then for those events anis . Thus the weight factors wnNin Eq. . are analogous to anL in the analysis of real data. We can also examine the eect of weights on the statistical error in Eq. .. The expected errorEis given by E N NNX n wnFfnhwFi . HerehwFiindicates an average. If it is very expensive to use a large N for instance because calculating Ffn requires a full detector simulation then one would like to make Eas small as possible for a xed N. That means not that wnshould be constant but thatwnFfn should be approximately constant for the observables Fof most interest. It is never possible to make wnFfnhwFi for all events but one does not want to have lots of events for which this ratio is much smaller than nor any events for which the ratio is much bigger than . Having events for which wnFfnhwFi is not a good thing but sincejjis not much larger than it is not really damaging from the point of view of avoiding large statistical errors. Evidently having weights that are real numbers of either sign or complex numbers does not make it impossible to apply Eq. .. It does however make the analysis a little more complicated. That is a disadvantage. We also note that having weights that are real numbers of either sign makes it clear that the calculation in Eq. . is not the same as the analysis of real data using Eq. .. Thus there can be no illusion that the parton shower Monte Carlo event generator is the same as nature. Perhaps this gentle reminder might be regarded as an advantage of having negative weights. Preview. Since this is a rather lengthy paper some preview of what is in it may be helpful. Section contains an introduction to the notation we use. This notation is we think useful for thinking about a variety of formulations of the parton shower idea. Thus if our primary interest were in the high PTtail of a jet PTdistribution we would not want to use most of the available computer time to generate low PTevents. Rather we would want to generate few lowPTevents giving each of them a high weight to compensate. We present it in the context of a simple scalar eld theory that is free from a lot of the complications of quantum chromodynamics QCD. We then turn to QCD with its complications. We present in Sec. the structure that we propose for a parton shower that contains quantum interference. In order to present this structure in just a few pages we leave for later sections most of the detailed denitions. The rst of these the momentum and avor mapping is covered in Sec. . Then Sec. covers spin. This provides enough background to present the splitting functions for the quantum amplitudes in Sec. . The description of color which is rather more complicated than that of spin is presented in Sec. . We are then able to specify the shower evolution operator in Secs. and. We follow this with discussions of two interesting issues the evolution of color in Sec. and soft gluon coherence in Sec. . We analyze the structure of the functions that appear in the Sudakov exponent in Sec. . Eventually shower evolution stops and a hadronization model is inserted. We discuss this in Sec. . We present some concluding remarks in Sec.. There are two appendices that deal with certain technical issues. . A notation for parton showers Starting in the next section we present a formulation for parton showers in QCD hard scattering events in hadronhadron collisions taking into account the complexities intro duced by spin and color correlations and by soft wide angle gluon emissions in addition to collinear splittings. In order to do this we use a mathematical language that helps to organize the algorithm. Alas the complexities of the real physical situation make the needed construction a bit subtle. Therefore in this section we rst introduce some of the needed language in a simpler situation. The notation introduced here will be used again for QCD in the subsequent sections. Consider the process eehadrons in a world in which hadrons consist of just one kind of massless scalar particle which has no color. The eeannihilation produces a pair of virtual scalar particles through an interaction that we need not specify. In the evolution of the hadronic state we can still have collinear singularities similar to those found in QCD if the theory consists of theory in six dimensional spacetime. The cross section to measure an observable Fcan be written as F X m mZ dfpgm jMfpgmjFfpgm . Here there is a sum over the number mof produced particles fpgmfppmg and Z dfpgm mY iZdpi p i PmX ipi . withP ps. The function Mfpgm gives the matrix element to produce mparticles with momentafpgm whileFfpgm describes the measurement to be done. We want to describe this using an algorithm that approximates jMfpgmjbased on jMfpgmjform and the subsequent generation of the rest of the particles based on a narrow angle approximation for one particle to split into two. This is to be done using a Monte Carlo simulation in which the system evolves from particles to many particles as a simulation time tprogresses from t to a large value at which the simulation is terminated. There are various possibilities for the physical meaning of the time t. We will take it that a splitting lijoccurs at time t logQ pipj whereQ is the hardness scale of the hard interaction with which we start. At each stage of this simulation let the cross section to have mparticles with momenta fpgmbefpgmt. Summing over the number of particles and integrating over momenta gives the total cross section TX m mZ dfpgm fpgmt . At the nal time tf the value of the measurement function is F X m mZ dfpgm fpgmtfFfpgm . The possible functions at a given time t form a vector space so that at time tcan be considered to be a vectort . We use rounded brackets here. The notation is reserved for a quantum state while denotes a state in the sense of statistical mechanics. We therefore call it a statistical state. The inner product is AB X m mZ dfpgm AfpgmBfpgm . We can dene basis vectorsfpgm in this space so that fpgmt fpgmt . With these denitions there is a completeness relation X m mZ dfpgmfpgm fpgm . The measurement function Fcan also be considered to be a vector F. Thus F Ftf . There is a special vector with fpgm . This vector represents the totally inclusive measurement function corresponding to the total cross section T t . Note that there is no here. Now we are ready to discuss the evolution of the statistical state. We take the evolution to be given by a linear operator Utt with t Uttt . HereUtt . These operators have the group composition property UttUtt Utt . The class of evolution operators that we will use is dened by two operators. The rst is an innitesimal generator of evolution or hamiltonian HIt. We can specify HIt by giving its action on an arbitrary state HIt . In a lowest order shower the operator HIt describes parton splitting changing a state withmparticles to one with m particles. One of the particles in fpgm say particle l is removed and replaced by two with momenta pland pm. The quantum amplitude after the splitting is approximately MfpgmMfpgmg plpm . Here to precisely dene the righthand side one needs to redene the momenta so that the mother parton has a momentum plpl pmthat is nevertheless onshell p l . Thus the momentafpgmare functions of the momenta fpgm. We omit a discussion here of the various ways to dene this momentum mapping. More important for now is the idea that the quantum matrix element factorizes in the form . when plpmis much smaller than any of the dot products among the momenta in fpgm. This factorization is at the heart of the reason why parton shower Monte Carlo programs give useful approximations. For the statistical splitting function in Eq. . we need the square of the quantum amplitude. Thus we want fpgmHIt X l tlogQ plpmg plpm fpgm . We have inserted the denition of the Monte Carlo time t that we here imagine using. For our present pedagogical purposes the details of the denition of HIt are not so important. What is important is that it re ects the factorization .. The second operator used in the construction of Utt is a nochange operator Ntt withNtt and NttNtt Ntt . The nochange operator leaves the basis states unchanged except for multiplying each of them by an eigenvalue Nttfpgm ttfpgmfpgm . Figure Illustration of Eq. .. The wide ovals represent the evolution operator Uwhile the narrow ovals represent the no change operator N which provides the Sudakov exponentials and the small circle is a parton splitting. Shower time truns from left to right. The evolution operator Uis expressed in terms of the hamiltonian and the nochange operators by see Fig. Utt Ntt Zt tdtUttHItNtt . This equation is interpreted as saying that either the system evolves without splitting from ttot or else it evolves without splitting until an intermediate time t splits att and then evolves possibly with further splittings from ttot. We need one more ingredient. We wish to construct the evolution so that it leaves the total cross section invariant Utt . This should hold for every state so Utt . This assumption denes what Ntt has to be. Multiply Eq. . on the left by and on the right byfpgm . Then using Eqs. . and . we have ttfpgm Zt tdt HItfpgm ttfpgm . If we now dierentiate with respect to t we get d dtttfpgm HItfpgm ttfpgm . The solution of this with the initial condition ttfpgm is ttfpgm exp Zt td HIfpgm . This result has a simple interpretation. The quantity HIfpgm is the total proba bility for one of the partons in the state fpgmto split at time . The exponential known as the Sudakov factor is the probability that none of these partons splits between tand t. This operator notation provides a convenient way to express the essence of standard shower Monte Carlo algorithms. Dierent algorithms dier in how the evolution variable t is dened and in exactly what the splitting operator HIt is. At its heart the shower Monte Carlo idea is that soft interactions factor from hard interactions in QCD. After being produced in a hard interaction partons in QCD travel a long way before undergoing much softer interactions such as splitting. What subsequent splitting does occur does not much change the basic hard matrix element for producing almost onshell partons. There are some complications however. On shell partons carry both spin and color. Furthermore soft gluons can transmit color changes over long dis tances. In the subsequent sections we will extend the meaning of the symbols used here so as to accommodate spin and color. . Structure of the calculation In this section we introduce notational conventions and a general structure for the calcu lation that we will use later in the paper. . The space of quantum parton states In order to describe showers we need a notation for the description of quantum states consisting of two initial state partons and mnal state partons. The partons are labeled by an index such as ithat takes values a or b for the initial state partons and m for the nal state partons. Each parton is described by a momentum p a avorf fgu uddg a spin index sand a color index c. We denote the quantum numbers of such a state by fpfscgmfaas acabbs bcbpfscpmfmsmcmg . Here there is a special notation with respect to the incoming partons. The momentum fractions of the incoming partons are denoted by aandb dened below. We call the avor of parton a simply aand we call the avor of parton b simply b. This notation is useful for designating the parton distribution functions faAa F andfbBb F. For the purpose of describing backward evolution of the initial state partons we will often need the anti avors of the incoming partons. We use faandfbfor these faa fbb . Here our notation is u u u ug g etc. The nal state partons are always onshell. Our kinematics allows parton masses with p jmfj . To describe the momenta of the initial state partons we start by dening pAandpBto be massless approximations to the momenta of the two incoming hadrons p A p B pApBs . The initial state partons are onshell. In general they can have masses but with a small modication of the notation their masses could be set to zero.In any case we take the initial state partons to have zero transverse momentum. Thus paapAmfa aspB pbbpBmfb bspA. This denes the momentum fractions aandb. In the event that we include parton masses the hardness scale Q at which the parton shower is initiated should be much bigger than the mass of any parton that is included as a possible constituent of the incoming hadrons. For example if the hard process were ttproduction near threshold then top quarks should not be used as possible initial state partons. Thus we demand that Q m H . wheremHis the mass of the heaviest quark that is included as an initial state parton typically the bquark. In any reasonable application of the formalism of this paper the here will be . Equation . suces to make certain kinematic formulas in the paper work. At any stage in the shower we dene papbQ. At the rst step the starting hard scattering with a sensible denition of the starting hardness scale we must haveQQ . The values of Qincrease as the shower develops. Thus at any stage we will have papbm H . We will impose a kinematic restriction on the momentum fractions mfb bsamfa asb . These limits require that the momentum in the system in the direction of pAcomes mainly from parton a and the same for pApB ab. We can be sure that both conditions hold by requiring absm H . The reason for imposing this condition is as follows. Given Eq. . there are two choices forabsthat yield the same value of papb. As long as condition . holds the There are several possibilities for the treatment of masses of initial state partons and there are some subtle issues associated with the choice. We mention some of these issues in Sec. . larger of the two choices for abssatises Eq. .. Imposing Eq. . eliminates the other solution in which parton a moves in approximately the pBdirection and parton b moves in approximately the pAdirection creating a large value for papb. The upper limit on aandbis . We note here that this is an approximation. To discuss this let nAandnBbe dimensionless lightlike vectors in the directions of pAand pBrespectively normalized to nAnB . Then consider for example the limit on a. The total momentum in the direction of nAof the nal state particles is papbnB amfb bs pAnB . This can be bigger than the available momentum pAnBifais very close to . A remedy for this would be to redene pAandpBin our formulas. Suppose that the exact hadron momenta are PAandPB. Then if we put pA PAnBnA pB PBnAnB. then there is a value of that makes pApB PAPB. By taking a value of that is a little smaller than this one can ensure that the momentum in the nal state in the directions of nAandnBis not more than was present in the initial state. It is this momentum that is available for the underlying event. With this adjustment the value ofsin our formulas is a little less than the true c.m. squared energy PAPB. Our notation with respect to spin and color is meant to be exible. A standard helicity basis will work for spin. For color we begin with a straightforward basis in which each partonihas a color index cithat can take values for quarks and antiquarks and . . . for gluons. Later we will want to consider the subspace of the whole color space in which the parton state is a singlet under the SU color group. We will choose a basis for this subspace. Using this basis we will still have labels that we can call fcgm but the new labels will describe the color links among the partons rather than individual color indices cifor the individual partons. The notation fpfcsgmis thus supposed to include the possibility of any representation of the colors of the m partons. . The density matrix A matrix element used in the computation of a cross section can be thought of as having the form of a function of the momenta and avors that carries indices for spin and color Mfpfgmcacbccmsasbssm . Here we denote the functions Mfor dierent numbers mof nal state partons by the same name simply Mfpfgm rather than Mmfpfgm. The array Mcan be thought of as a vector in spin and color spaceMfpfgm . The inner product MM denotes multiplying MbyMand summing over the spins and colors. An observable Fcan be specied by giving a set of functions Ffpfgm that are linear operators on the colorspin space. In many important cases Ffpfgm is a function times the unit operator on colorspin space. If Fis be simply made from theta functions dening nal state cuts then F is the cross section to nd the nal state partons within the cuts. With this notation the cross section for an observable Ftakes the form F X m mZ dfpfgmfaAa FfbBb F ncancb abpApB MfpfgmFfpfgmMfpfgm . Here the functions fare parton distribution functions while nca is the number of colors that a parton of avor acan haveNc for a quark or antiquark N c for a gluon. The factor ncancb turns the sum over spins and colors for the initial state partons into an average over spins and colors. We have indicated the appropriate integrations over momenta by Z dfpfgm gfpfgmmY i X fiZdpi p imfi X aZ daX bZ db papbmX ipi m Habs gfpfgm . Heregfpfgm is an arbitrary function. The nal state particles carry labels ifmg. Then particle ihas momentum avor spin and color given by fpifisicig. One can arrange the denitions such that the amplitudeMis symmetric under interchange of the labels. However we do not necessarily do so. Instead the notation allows for a general labeling scheme.A measurement function Fmust be symmetric under interchange of labels since the labels are not physical. Two amplitudes Mthat become the same if the labels are symmetrized are equivalent. We will nd it useful to rewrite F in the form of a trace over the spin and color space F X m mZ dfpfgm TrffpfgmFfpfgmg . where fpfgm MfpfgmfaAa FfbBb F ncancb abpApB Mfpfgm . This formula contains a parton ux factor abpApBthat corresponds to massless partons. The ux factor for scattering of free massive particles is more complicated. However papbis always bigger than the initial hard scale Q and the formalism of this paper is valid only when Q is much larger than the masses of any initial state partons. For this reason we use the ux factor for massless parton scattering. Just to take a trivial example in a u ug state the label might be assigned to the up quark to the antiup quark and to the gluon. Of course it will not work in general to use the avors as labels because one can have two nal state partons with the same label. Thusis the density operator in color spin space. It is illustrated in Fig. . The density operator for momentum as well as spin is widely used as the basis of quantum statistical mechanics. It was introduced for the spin space in parton showers by Collins and is used in H ERWIG for the heavy partner particles in supersymmetry . Figure Illustration of a contribution to Eq. .. The Feynman graph on the left is a contribution toMfpfgm and the Feynman graph on the right is a contribution to Mfpfgm. The factor with parton distributions is not illustrated. The momenta and avors of the labeled partons match betweenMfpfgm and Mfpfgm but the partons on the left have colors and spinsfscgmwhile those on the right have possibly dierent colors and spins fscgm. Additionally can contain quantum interference between dierent graphs as illustrated here. We imagine that eventually the partons will evolve to form a nal state in the middle and an initial state on the left and right. We can expand fpfgm in basis statesfscgm for the color spin space fpfgm X scX scfscgm fpfscscgm fscgm . Herefpfscscgm is a function that depends on the momenta and avors fpfgm the labelsfscgmfor the quantum ket state and the labels fscgmfor the conjugate quantum bra state. We denote the state labels collectively by fpfscscgm. Thus fpfscscgm a function giving the matrix elements of the density matrix. We nd it convenient to base our treatment on this function. Later we will choose an orthonormal basis for the spin space so that fsgmfsgm fsgm fsgm . For the color space we will nd it convenient to use a basis in which fcgmfcgm is approximately but not exactly and where fcgmfcgm is not generally zero for fcgm fcgm. With a nonorthogonal basis we need to be a little careful about the notation. Suppose that we expand a vector in such a basis X fcgmfcgm afcgm . A convenient representation for the expansion coecients afcgm is obtained by taking matrix elements with elements of the dual basisfcgm Ddenedby D fcgmfcgm fcgm fcgm . Using the dual basis we can write D fcgm afcgm . The expansion of any vector in the basisfcgm can conveniently be obtained directly by using the completeness relation X fcgmfcgm D fcgm . If we want to expand a bra vector in the basis fcgmwe can use the completeness relation X fcgmfcgm D fcgm . This is particularly useful with respect to operators. Let Obe a linear operator on the color space. If has expansion coecients afcgm dened by Eq. . and O has expansion coecients afcgm thenOis conventionally described by the matrix dened by afcgm X fcgmofcgmfcgmafcgm . We can write this as ofcgmfcgm D fcgmOfcgm . . Statistical states The set of functions fpfscscgm forms a vector space which we can call the statis tical state space as distinct from the quantum state space. We can call the vector corre sponding to this function simply . Note the rounded brackets instead of angle brackets that we use for quantum states as in . We can dene basis vectors fpfscscgm for the statistical state spaceso that fpfscscgm fpfscscgm . There are also ket basis vectors such that the completeness relation for the basis states is X m mZ dfpfscscgmfpfscscgm fpfscscgm . Readers familiar with general relativity can think of fcgma as the covariant components acofa and D fcgma as the contravariant components ac. One can lower indices using the metric tensor gcc analogous to fcgmfcgm . The inverse matrix D fcgmfcgm Dis analogous to gcc. More precisely the bra vectors Fare vectors in the dual space to the ket vectors that is the space of linear functions on the vectors . where dfpfssccgm is an extension of the integration measure Eq. . Z dfpfscscgm Z dfpfgmX sasacacaX sbs bcbc bmY i X sis icic i . The corresponding inner product of basis states is fpfscscgmfpfscscgm mmfpfscscgmfpfscscgm . where the function is a generalization of the ordinary deltafunction that is dened by mZ dfpfscscgm fpfscscgmfpfscscgmhfpfscscgm hfpfscscgm . Herehis any well behaved function of the variables indicated dened on the integration surface. Let us dene a vector corresponding to a measurement function Fusing Ffpfscscgm fscgmFfpfgmfscgm . Then using the completeness relation . the cross section . corresponding to a measurement function Fcan be expressed using Eqs. . and . as F F . In the case that Fconsists of a function Ffpfgm times a unit operator in spincolor space the inner product F is F X m mZ dfpfscscgm Ffpfgm fsgmfsgm fcgmfcgm fpfscscgm. . The resolution scale We now need to introduce a resolution scale into our equations. We rst discuss the reso lution scale of the observable. In Eq. . let us suppose that the observable represented by the functions Ffpfgm is infrared safe. To be precise about what this means we rst demand that the functions Ffpfgm be smooth functions of the momentum variables and that they be invariant under label interchanges. Then we consider a list of parton variables fpfgmform partons and suppose that pmbecomes collinear with the momentum plof partonl. Then we can consider the list of parton momenta fpfgmwherepj pj andfjfjforjlwhilepl pm plandflfmflwith the obvious denition Note that this equation for the measurement function has a dierent structure from the equation used to dene the statistical state vector fpfgm fscgm fpfscscgm fscgm. of adding avors. That is the partons with variables fpfgmcould have arisen from partons with variables fpfgmby the collinear splitting of parton linto new partons with labelslandm . Then infrared safety requires that FfpfgmFfpfgm . in the limit. This should also hold if parton m becomes soft pm. It should also hold with a suitable adjustment of the notation for a splitting of one of the initial state partons. This is so far just the standard denition of infrared safety. It allows us to have perturbatively calculable cross sections. Now let us extend the denition to include a scale. We can say that the observable is infrared safe at scale if FfpfgmFfpfgm . whenjpmplj. To be really precise we should specify how good this approximation has to be but this will not matter for our purposes. Strictly speaking an infrared safe observable without further qualication is one that is infrared safe at any scale no matter how small. However what is usually meant is that it is infrared safe at a scale not much smaller than the scale Q of the hardest interaction in the problem. What we want to do here is to specify the splitting scale at which the observable is sensitive to the splitting. That scale could be much smaller than Q . Now we introduce the concept of the density operator evaluated at resolution scale . The idea is that interactions with scales greater than are included inM Mwhile interactions with scales smaller than are integrated out for nal state interactions or included in the parton distributions for initial state interactions.We can describe this in a rough way as follows. In each cut Feynman diagram each integration region for nal state partons that produces a collinear or soft divergence can be described as a region in which some group of partons with labels ibecome collinear to a given direction of a mother parton or some become soft so that P ipi. Divide this region into subregions with P ipiand P ipi. In the P ipiregion we can combine the partons i into a single eective parton for purposes of calculating the observable. That is the partons iare unresolved. This leads to a free integration over this region using a constant Ffor fewer partons. Adding these real emission integrals to the corresponding virtual diagrams and counterterms from the parton distributions gives a nite result containing logarithms ofQ . A more intuitive way of thinking about this is to imagine writing the Feynman diagrams in a coordinate space representation in which we integrate over the positions x iof the interaction vertices relative to the position of the hard interaction which is determined to within Q . Then we can restrict these integrations to jx ijbefore integrating over the nal state momenta. In order that the parton distributions in Eq. . include initial state interactions at all scales smaller than the factorization scale Fat which the parton distributions are evaluated should be . This is the idea of the standard factorization theorem . However we here go beyond anything that has been proved. With this meaning of evaluated at resolution scale F is invariant under as long asFis infrared safe at a scale equal to or larger. However if one looks at with a resolution scale smaller than then F does see the eect of changing. Our object in this paper is to construct an approximate version of as a function of the resolution scale. The idea is to construct using a parton shower starting from Q and evolving to smaller values of down to a nal infrared cuto. This intuitively appealing idea has been inherent in the idea of a parton shower since the earliest days. It would be very useful to have a precise eld theoretic denition as a function of resolution scale. However this is beyond our scope in this paper. One nds that the logarithm of the resolution scale is more useful as a variable than itself. Therefore we dene Monte Carlo time tby Q et. and write the density operator with this resolution scale ast . Then also the parton distributions are evaluated at factorization scale FQ et . . Parton shower evolution We are now prepared to set up a quite general framework for describing a parton shower. We take the framework as a set of axioms that we hope are reasonably intuitive. Later we relate the operators that occur to the structure of Green functions at tree level in QCD. We use the evolution variable tthat species the resolution scale of according to Eq. .. Thuststarts at zero and increasing tcorresponds to decreasing virtuality. In principle the shower can evolve to tbut one actually stops evolution at an infrared cutotfthat corresponds say to a GeVvirtuality. The evolving shower is represented by a statet that begins with an initial state . The evolution is given by a linear operatorUtt witht Uttt . HereUtt . These operators have the group composition property UttUtt Utt . The class of evolution operators that will use is dened by two operators HIt and Vt according to the dierential equation d dtUtt HItVtUtt . with initial condition Utt . The rst operator HIt represents parton interactions and in general changes the number of partons and their momenta. We specify HIt by giving its matrix elements fpfscscgmHItfpfscscgm . In a lowest order shower which we consider in this paper the operator HIt describes parton splitting changing a state with mnal state partons to one with m nal state partons. The second operator that controls evolution Vt describes the eect of virtual graphs and the unresolved part of real emission graphs. In a lowest order shower we do not account for the virtual graphs exactly but rather account for only the infrared singular part of the virtual graphs which can be deduced from the real emission graphs. That is Vt is determined from HIt. The operatorVt does not change the number of partons or their avors or spins but can change their color states. We construct the shower algorithm in such a way that it conserves probability in a certain sense. If we were dealing with eehadrons we would demand that the devel opment of the shower does not change the total cross section. For hadronhadron collisions the total cross section does not have a well dened perturbative expansion. However if we start with a state that is hard in the sense that fpfscscgm is nonzero only for parton congurations with a large transverse energy then we can demand that as this state evolves into the shower the contribution fromt to the total cross section does not change. The observable that measures the total cross section is Ffpfgm . We will call the vector corresponding to Fsimply . Using Eq. . the inner product of with a basis state is fpfscscgm fsgmfsgm fcgmfcgm . The statement that shower evolution leaves contributions to the total cross section invariant is Utt . for any suitably hard state . This requirement leads to a relation between the matrix elements ofV andHI. To derive this relation we multiply Eq. . on the left by and on the right by . After using Eq. . we get HItVtUtt . Since this holds for any suitably hard state we have HItVt . We multiply on the right byfpfscscgm to obtain Vtfpfscscgm HItfpfscscgm . At this point we need to discuss the structure of the parton splitting operator HI. In subsequent sections we derive the form of HIt based on the structure of QCD tree level matrix elements in the limit that two of the m partons become massless and collinear one becomes massless and collinear with one of the beam directions or one a gluon becomes soft. In this limit the matrix elements take a factored form hard softcollinear . This factorization leads to the denitionofHIt in Sec. . At the moment what we need is the structure of HItfpfscscgm which represents the inclusive splitting probability at splitting scale t. We will nd HItfpfscscgm fsgmfsgm fcgmhtfpfgmfcgm . where the function htfpfgm is given in Sec. Eq. . . The important point is that there is a trivial spin structure and a nontrivial color structure. We take the operator Vt to operate only on the color space and dene its action in terms of its matrix elements for which we use the notation fccgmVtfpfgmfccgm . The denition of Vt in terms of these matrix elements is Vtfpfscscgm X fccgmfpfscscgm fccgmVtfpfgmfccgm . Thus using Eq. . Vtfpfscscgm X fccgm fsgmfsgm fcgmfcgm fccgmVtfpfgmfccgm . If we insert Eq. . and Eq. . into Eq. . and cancel the spin factors we get X fccgm fcgmfcgm fccgmVtfpfgmfccgm fcgmhtfpfgmfcgm . There is a simple way to satisfy this equation. We dene fccgmVtfpfgmfccgm D fcgmhtfpfgmfcgm fcgm fcgm fcgm fcgm fcgmhtfpfgmfcgm D. What we have done here is to decompose fccgmVtfpfgmfccgm into two terms. In the rst term nothing happens on the bra side of the density matrix but there is a virtual correction on the ket side while in the second term nothing happens on the ket side of the density matrix but there is a virtual correction on the bra side.With this denition when we perform the sums over fcgmandfcgmin Eq. . using Eq. . we see that Eq. . is satised. The denition is not unique because there is freedom to choose what to do away from the soft and collinear limits WhatVcontains is the singular parts of the virtual corrections which are related to the collinear and soft singularities of the real emission diagrams plus an unresolved contribution from the real emission diagrams. Thus we obtain VfromH. We note that one could imagine solving Eq. . numerically in the form Ut t VttUt HIttUt . That is one could use small time steps in which either one of the partons splits or else no parton splits and the weights for dierent color states are readjusted. However this is not the way that shower evolution is typically constructed. To proceed down a more traditional path we dene two other operators VEt and VSt with sum VEt VSt Vt . The distinction between VEt andVSt lies in how we treat them within shower generation VEt is exponentiated and VSt is subtracted. We express the solution of Eq. . in the form Utt Ntt Zt tdUt HIVSNt . where the operator Ntt is the time ordered exponential of the operator VEt Ntt Texp Zt tdVE . HereTrepresents the ordering in evolution time t. The operatorNtt is a generalization of the standard Sudakov exponential in parton shower Monte Carlo programs. It has the group multiplication property NttNtt Ntt . and satises the dierential equation d dtNtt VEtNtt . Eq. . is interpreted as saying that either the system evolves without splitting from t tot or else it evolves without splitting until an intermediate time splits or undergoes a color change at and then evolves possibly with further splittings or color changes from tot. The rst term contains a summation of eects from virtual splittings. In the second term we have a parton splitting contribution along with a subtraction that arises from the part of the virtual splitting contribution that was not summed to form part of Ntt. Now the operator Vt is completely dened but we still need to dene VEt andVSt. Here we have some freedom. There are at least three obvious choices . We could dene VEt . ThenVSt Vt. This choice leads to a trivial Sudakov exponentialNtt . This is similar to what one does in xed order calculations when the singularities of the real emission graphs with m nal state partons are removed by the subtraction terms with mpartons. This is not useful in the context of a parton shower. . We could dene VSt . ThenVEt Vt. This means we exponentiate the whole virtual splitting operator. It is the most shower way to organize the parton evolution. The integral of Vt over a range of tproduces large logarithms and all of these logarithms appear in the Sudakov exponent. Since Vt is a nondiagonal matrix in color space the implementation of this choice may present diculties. . Alternatively we can dene VEt to be the diagonal in color as follows fccgmVEtfpfgmfccgm fcgm fcgmfcgm fcgm fcgmhtfpfgmfcgm fcgmhtfpfgmfcgm . ThenVSt is VStfpfgm VtfpfgmVEtfpfgm . With this choice the computation of the operator Ntt is simple because the basis vectors in the statistical space are eigenvectors of the operator VEt. With this alternative we do not exponentiate everything. However when we study color in the following sections we will see with this choice that with the color basis that we will choose VSt is small compared to VEt. First we have fcgmhtfpfgmfcgm X fcgm fcgmfcgm D fcgmhtfpfgmfcgm fcgmhtfpfgmfcgm X fcgm fcgmhtfpfgmfcgm D fcgmfcgm . We will see in Eq. . that the matrix fcgmfcgm is the unit matrix except for N ccorrections. Thus the dierence between using dual basis vectorsfcgm Din Eq. . and ordinary basis vectorsfcgm is not important in the large Nclimit. Second we will see in Sec. that the matrix fcgmhtfpfgmfcgm is almost diagonal in the sense that its odiagonal matrix elements are suppressed compared to its diagonal matrix elements by factors of N c. Thus the part of the virtual contribution that is not exponentiated is small. This small part is not neglected but we can leave it out of the Sudakov exponent and treat it as a subtraction instead. Eectively this means that we treat N cas a small parameter in addition to s. . Momentum and avor mapping In this and the following sections we explore how to dene the splitting operator HI. The rst issue to examine is the momentum mapping. We begin with an mparton state with momentafpgm. One of the partons with label lfabmg splits. After the splitting we have an m parton state with momenta fpgm. Our notation is that partonlsplits into partons with labels landm while the other partons keep their labels. The momenta fpgmafter splitting are determined by the momenta fpgmand a momentum splitting variable that we call p which denes the momenta of the daughter partons. There is also a avor splitting variable f which tells the daughter avors. In this section we rst describe the splitting of a nal state parton then move on to the somewhat more complicated splitting of an initial state parton. For the nal state splitting we rst describe how fpfgmis determined from fpfgmandfpfg. Then we state the inverse transformation from fpfgmtofpfgmandfpfg. Finally we deduce the jacobian for this change of variables. We will then be ready to do the same thing for the splitting of an initial state parton. There are many ways to dene the momentum mapping fpgmfpgm. One of the most successful is that of Catani and Seymour . This may be called a local mapping the momenta of most of the partons are left unchanged while the momenta of two partons are mapped into the momenta of three partons plpkplpmpk. Here parton k is a spectator parton chosen as one of the partons that is color connected to parton l. There is an exception to this rule in the case of initial state splittings. The antenna factorization of Ref. also uses a local mapping. We use a global mapping in which all of the partons participate as in Ref. . This way each parton has to contribute only a little momentum. We also include quark masses in the kinematics. . Splitting a nal state parton We begin by dening what happens to the parton avors when a nal state parton lsplits. The partons with indices other than landm keep their avors fjfj j flm g . What happens to partons landm is given by the value of the variable f flfm. The avor splitting variable takes values in a set lfl that depends on the avor of the mother parton. If parton lis a quark or antiquark then the set lfl has only one element lfl fflgg fl g . Here we have used the freedom to assign labels in order to assign the label lto the daughter quark or antiquark and the label m to the gluon. If parton lis a gluon then fcan be a pair of gluons or any choice of qq avors lg fggu uddg . In the case of a g q qsplitting we again use the freedom to assign labels in order to assign the label lto the daughter quark the label m to the daughter antiquark. We now turn to the momenta. Parton lhas momentum plwithp lmfl and splits into two partons landm with momenta pland pmrespectively. The daughter partons are onshell p lmfl and p mmfm. We always have pl pmmfl. We need a bit of notation. Let Qbe the total momentum of the nal state partons QmX jpjpapb . Dene alQ plQ blmfl plQ. Note thatalbl. To see this let KQplbe the total momentum of the nal state spectator partons with K. Then K plQ QplQmfl plQ albl. In order to dene the momentum mapping we rst determine the total momentum Pl pl pm . of the daughters of parton l. We takePlto be a linear combination of plandQ Plply alQ . There are two parameters in this denition. The rst y is a measure of the virtuality P lmfl of the splitting. The second is a function of ythat we will determine presently. For an exactly collinear splitting or the emission of gluon with momentum pm we havePlpl. Away from these limits the spectator partons will have to donate some momentum in order to allow Plpl. We elect to leave the momenta of the initial state partons unchanged papaand pbpb. Instead we choose to obtain the needed momentum from the nal state spectator partons by letting the momenta after the splitting be related to the momenta before the splitting by a Lorentz transformation p j p j j flm g . With this method of transferring momentum each parton donates a share of the needed momentum with low momentum partons donating only a little momentum. The total momentum of the nal state spectator partons before the splitting is KQpl . Since the momenta of the initial state partons remains the same Q pa pbis the same asQ. The total momentum of the nal state spectator partons after the splitting is then KQPl . Since each nal state spectator is changed by a Lorentz transformation we have K K . In fact there is a Lorentz transformation that does this namely KK g KKKK KKKK K . provided that KK. ThusPlmust lie on the hyperbola QPl Qplin the Qplplane as illustrated in Fig. . In the case in which the momenta Kand Kare carried by a single massless spectator Kis parallel to K. In this case one can use an alternative representation of the boost in Eq. . that remains well dened when K KK KK g Kn Kn nn Kn Kn nn . wherenand nare lightlike vectors in the Qplplane with nn and plnpln QnQn. That is these are the vectors along the two coordinate axes in Fig. with ndirected toward the upper right and ndirected toward the upper left in the diagram. Figure Momentum space mapping for a nal state splitting. Coordinate axes in the two lightlike directions in the plane of plandQare shown. Points plandQare shown in the case that plis nearly lightlike. Then Pllies on the hyperbola QPlconstthat passes through pl. We can arrange that KKby making a proper choice of in Eq. .. We have K albl Qpl . and K al alyalbl Qpl . We obtain KKif s yalybl albl . We note that wheny. Asyincreasesdecreases. There is a maximum possible value of y namely the value that makes ymaxpalp albl bl . The splitting parameter yhas a simple meaning. From Eq. . we nd using Eq. . yP lmfl plQ . That isyis a dimensionless measure of the virtuality of the splitting. An alternative relation is yP lmfl PlQP lmfl . There are also alternative relations for alandbl alQ PlQmflP l blmfl PlQmflP l. These relations can be derived with the use of the relation PlQ y plQ . There is also a minimum value of y. SinceP lmfl mfm we haveyy min where yminmfl mfmmfl plQ . Note that if all of the partons are massless then ymin . In addition if flflis a massive quark avor and fm g then also ymin . We have seen how given the virtuality variable y we can dene Pl pl pmin the plane ofplandQsuch thatP lmfl yplQand so that the needed momentum donation from the spectator partons can be obtained by a Lorentz transformation. It remains to dene pland pmindividually. This is simple. We let pland pmbe any momenta on the appropriate mass shells that sum to Pl. It will prove convenient to formulate this rather abstractly. We denote the daughter parton momenta by pplpm . We must have plfpgmf . where the set lfpgmf is described as follows lfpgmf n plpmp lmflplQ p mmfmpmQ p l p mp lQ Qplpm Qplo . That is each of pland pmlies on the appropriate forward mass shell their sum lies in the plane of plandQ and KK. These conditions entail that mfl mfmpl pmp Qp QmflplQ . which corresponds to yminyymax. We give a name to this transformation of momenta and avors fpfgmRlfpfgmfpfg . In parton splittings close to the collinear or soft limits partons lose energy when they split. It is of interest to see how this property carries over to splittings that are not close to the limit. Here the choice of the mapping Rlmay be considered to be part of a model for shower evolution that could be sensible or perhaps not so sensible. An investigation of properties of the model is thus of some signicance. UsingKK we derive QplQpl pmK mflmfl mfm . This is especially interesting in the case that parton lis a quark and parton m is a gluon. Then the term involving masses vanishes. We note that pmK because both pmand Klie inside or on the forward light cone. Thus the energy of the quark as measured in the frame in which Qis at rest is bigger before the splitting than after the splitting. By emitting bremsstrahlung the quark slows down. If evolution of the nal state were to continue long enough the quark would slow to a stop in the Q frame. Then radiation from that quark would cease. At any point in the shower evolution there can be an initial state splitting discussed below in Sec. .. This changes paorpband thuspapbQ. Now nal state quarks tend to come to rest in the new Q frame. We judge that a tendency for quarks to slow down and similarly for gluons to lose energy is reasonably sensible. Of course the partons should not be allowed to shower indenitely. At some resolution scale a perturbative model for showering is simply wrong and a process by which partons combine to form hadrons is needed. . Combining two nal state partons It is signicant and useful that this transformation has an inverse. Let start with fpgm and determinefpgmandfpfg. The splitting variable for the momenta is given by the momenta of the daughter par tonsp plpm. Fromfpgmwe determine QmX jpj pa pb . Then Eq. . givesy Eq. . givesalandbl and Eq. . gives. Since the calculation of involves taking the square root of we should check that . For this purpose we can express in terms of dot products of vectors as QPlQP l mfl PlKm QKPlKP lmfl P lmfl . SinceQPl and KQPllie inside or on the positive lightcone and P lmfl both the numerator and the denominator are nonnegative. With yalandblat hand one can calculate the lightlike momentum plby rearranging Eq. . pl pl pmy alQ . We now have pl. We dene pa paandpb pb. This leaves the pjforj flabg. For this we need the inverse Lorentz transformation to Eq. .. FromKQpland KQplpm we construct KK using Eq. . or Eq. . with the roles ofKandKinterchanged. Then p j KK p j j flabg . The transformation of the avors is simple. The splitting variable fis given by the avors of the daughter particles flfm. The avor of the mother parton is flflfm . with the obvious denition of adding avors as in d g d and u u g. The avors of the other partons are unchanged fjfj j flm g . We give a name to this transformation of momenta and avors ffpfgmfpfggQlfpfgm . This is the inverse transformation to Rl Eq. .. . The integration measure for nal state splitting With a suitable choice of the integration measure dpfor integrating over the splitting variablesp we can arrange that Z dfpfgmgfpfgm Z dfpfgmX flflZ dpplfpgmfgfpfgm. for an arbitrary function gfpfgm. The denition that we need is dpdy yminyy maxplQ dpl p lmfldpm p mmfm pl pmply alQ . Here the limits on yare given in Eqs. . and .. . Splitting an initial state parton Consider the splitting of an initial state parton say parton a. The initial state parton with momentum paapAsplits to produce a new initial state parton with momentum paapAand a new nal state parton with label m and momentum pm. We are using the usual backwards evolution here so that the evolution going forward in time is papa pm. In this subsection we describe how fpfgmis determined from fpfgm and splitting variables fpfg. The splitting of the other initial state parton is described by the same formulas with a b. We begin by dening what happens to the parton avors recalling our notation that for the initial state partons a and b fafafband fbdenote the opposite of the avor of the physical incoming parton. The partons with indices other than a and m keep their avors fjfj j fam g . What happens to partons a and m is given by the value of the variable f fafm. The avor splitting variable takes values in a set afa that depends on the avor of the mother parton. This set is determined by the requirement that fafafm. If parton a is a quark or antiquark then the set afa has only two elements afa ffaggfag f a g . If parton a is a gluon then fcan be a pair of gluons or any choice of qq or qq avors ag fggu u uuddddg . We now turn to the momenta. Let parton a with momentum fraction aradiate a partonm with momentum pm. We then need to dene how to determine fpgm fromfpgmand pm. As discussed in Sec. . we can include masses for the initial state partons.We take Recall that this is optional. One could just replace the masses for the initial state partons by zero mfa mfa mfb . One could also set all quark masses to zero. the partons to be onshell with zero transverse momenta paapAmfa aspB pbbpBmfb bspA pa apAmfa aspB. Recall that we dene pAandpBto be lightlike approximations to the incoming hadron momenta with pApBs. The radiated parton can have a mass p mmfm . We take the momentum fraction of parton b to remain the same bb . The momentum fraction aafter the splitting will be determined by pm. As in the case of a nal state splitting it is not generally possible to have papa pmgiven the mass shell conditions and the possibility that the radiated parton has nonzero transverse momentum. In order to allow the approximation that both paand paare onshell with zero transverse momenta we therefore take some momenta from the nal state spectator partons by letting the momenta after the splitting be related to the momenta before the splitting by a Lorentz transformation p j p j jfmg . Since each nal state spectator is changed by a Lorentz transformation we have K K . whereKis the momentum of the nal state partons before the splitting Kpapb . and Kis the momentum of the nal state spectators after the splitting K papbpm . In order for Kand Kto be related by a Lorentz transformation we need KK. To see what this means dene Qa papb amfb bs pA bpBmfa as pB . Then we demand that QapmK . The vector pmdetermines a. In the space of pm a surface of constant ais the intersection of the hyperbola p mmfm with the hyperbola given by Eq. . as illustrated in Fig. . Using p mmfm in Eq. . we can write QapmQamfmK . Looked at this way a surface of constant ais the intersection of the hyperbola p m mfm with the plane dened by Eq. .. We will require a. Thus the allowed region in p mis the part of the forward mass shell with QpmQmfmK . In order to solve for agiven pm we writeKand Kin the form Ka a K a a . Here bs mfamfb bs mfamfb. while bspApm mfa s pBpmmfb b pbpmmfamfbmfm. The condition KKnow determines a a K q K . It is a consequence of Eq. . and the kinematic conditions . and . that aa . We prove this in Appendix A. Having xed aso that KK these two momenta will be related by Eq. . K KK K . Figure Momentum space for pmin an initial state splitting. Coordinate axes along pAand pBare shown along with the point Qa. We show the mass shell for pmand the hyperbola QapmK. Points pmfor a given value of aare on the intersection of these two hyperbolas. We illustrate a point pmwith zero momentum transverse to pAandpB but in general pmcan have transverse components. The plane specied in Eq. . is also depicted. where the Lorentz transformation .. This allows us to dene the spectator mo menta after the splitting to be related to the spectator momenta before the splitting by this same boost as in Eq. . p j KK p j jfmg . For a nal state splitting we dened a splitting variable pin a three dimensional set lso thatfpgmtogether with pdeterminesfpgm. Here we use an analogous notation with p papm . We choose pafpgmf . where afpgmf n papmp mmfmpmpapb pa apAmfa aspB Ka KaKK aao . That is the radiated parton lies on the forward massshell and the new initial state parton is also on its mass shell with has zero transverse momentum. Its momentum fraction ais determined by KK withKinside the forward lightcone. The solution of KK is given by Eq. .. We also need ato be big enough that that the kinematic bound that was given in Eq. . is obeyed. This follows from aa. Finally amust be less than . We give a name to this transformation of momenta and avors Rlwithl a fpfgmRafpfgmfpfg . . Combining an initial state parton with a nal state parton The transformation for splitting an initial state parton has an inverse. Let us start with fpfgmand determinefpfgmandfpfg. The momentum splitting variable is simply p papm. For the momentum frac tion of parton b before the splitting we take b b . To determine a we simply use the representation . ofKand Kand solveKK forain terms of a. This gives a K q K . Once we have a we can construct Kpapb. Then from Kand Kwe can construct KK the inverse Lorentz transformation matrix to KK dened in Eq. . by simply using the same equation with KK. Then we can construct the remaining momenta using p j KK p j . The transformation of the avors is simple. The splitting variable fis given by the avors of the backwards evolution daughter particles fafm. The avor of the mother parton is fafafm . The avors of the other partons are unchanged fjfj j fam g . We give a name to this transformation of momenta and avors ffpfgmfpfggQafpfgm . This is the inverse transformation to Ra Eq. .. . The integration measure for initial state splitting With a suitable choice of the integration measure dpfor integrating over the splitting variablesp we can arrange that Z dfpfgmgfpfgm Z dfpfgmX fafaZ dppafpgmfgfpfgm. for an arbitrary function gfpfgm with support in Km H. The denition that we need is dpdpm p mmfm a a . The factor a a here is just dadacalculated from the relation KK. . Spin states The quantum scattering amplitudeMfpfgm is a vector in spin color space. Thus we can expand it in terms of spin and color basis vectors Mfpfgm X fcgmfcgmX fsgmfsgm Mfpfscgm . The treatment of color that appears to us to be most useful for parton showers is a bit subtle and in particular involves basis vectors that are not exactly conventionally normalized and are not exactly orthogonal to one another. The color basis is described in Sec. . In contrast our spin basis vectors are quite standard are orthogonal and normalized fsg mfsgm mmfsgmfsgm . The spin labelsfsasbssmgrepresent the helicities of the corresponding particles. The basis states for parton lare represented for quarks or antiquarks by Dirac spinors Uplsl orVplsl wherep lmfl. For gluons we need polarization vectors plsl withp l . Our denition makes use an auxiliary vector nl chosen along the intersection of the positive lightcone with the plane of plandQ whereQPm jpjpapbis the total momentum of the nal state particles. The normalization of nlis not important. We take the solution that is not close to plin the case that mfl is small. A convenient set of choices is nl pB l a pA l b QQ Qplp QplQmflpl lfmg. For quarks and antiquarks we use Dirac spinors Ups orVps withpmand s. We can take Vps UpsCT whereCis the charge conjugation matrix i in the chiral representation of the gamma matrices with C C Tand CCyCTC. The spinors obey pmUps and pmVps . They are normalized to Ups Ups p Vps Vps p. Many authors follow the convention that the helicity label for an incoming particle is the negative of the particles helicity. In contrast our convention is that saandsb as well as ss m represent the physical helicities of the particles. We use helicity eigenstates dened so that sUp Up sVp Vp. Here the spin vector sis s mpm pnn . wherenis the auxiliary lightlike vector from Eq. .. Thuss andsp . A convenient denition that denes the phase of Ups in terms of the phase of Ups is Ups m pnn Vps . For gluons we need polarization vectors psQ representing a given helicity sand dened with the aid of an auxiliary vector Q. The polarization vectors obey ppsQ and QpsQ . We can also write psQ psn . wherenpsn andnis a lightlike vector dened in Eq. .. We dene the phase by using the standard denition in terms of mass zero Dirac spinors pn Un Upp UpUn . With this denition there is a simple relation between polarization vectors dened with dierent auxiliary vectors Qand thus dierent lightlike auxiliary vectors n pnpn p UnUn UnUpUpUnp . If we use these polarization vectors with the exact treelevel Feynman diagrams gauge invariance of the matrix elements together with the fact that psn diers from psn by a vector proportional to p shows that the amplitude is independent of the choice of the auxiliary vector Q. Our matrix elements will be approximate and will be gauge invariant only to the extent that the splittings are close to the soft or collinear limits. Thus some dependence on the auxiliary vector used to dene the polarization vectors will result. . Splitting functions for the quantum states Consider for a moment a theory without spin color or avors say theory in six di mensions as in Sec. . An m parton scattering amplitude Mfpgm is simple in the limit in which two of the partons are approximately collinear. Supposing that partons m andlare almost collinear we have MfpgmvfpgmMfpgm . wherevfpgm gplpm. Herefpgmis determined from fpgmby the six dimensional version of the transformation described in Sec. . This factorization formula for the amplitude becomes exact in the limit that partons m andlbecome collinear. Away from the collinear limit there is some freedom to choose the momentum mapping and the splitting amplitude vfpgm. One has to make a denite choice based on ease of computation or conceptual simplicity. In the case of QCD we have soft as well as collinear singularities we have parton avors which are rather trivially treated and we have color and spin which are not so trivial. Let us see how to describe splitting in QCD. It has been known for a long time that QCD amplitudes factor in the soft and collinear limits . Indeed there are beautiful modern formulas for the factors . We have adopted a more pedestrian approach that has at least the advantage of encompassing the soft and collinear limits at the same time and of including masses. A treatment of the squared amplitude that is rather similar to the approach of this paper but at higher order may be found in Ref. . . Denition of the splitting functions vl The QCD scattering amplitude for m partons is a vectorMfpfgm in color spin space. In the limit that two partons landm are almost collinear this amplitude takes a certain limiting form Mfpfgm Mlfpfgm . whereMlfpfgm is to be dened precisely below. When pmbecomes soft then all of theMlfpfgm amplitudes contribute to the limit Mfpfgm X lMlfpfgm . We arrange the denition so that Eqs. . and . are exact in the collinear or soft limit respectively. We also arrange thatMlfpfgm is dened for anyfpfgm. Then these equations are approximate away from the limit. The amplitudeMlfpfgm is then the contribution to the m parton amplitude from the splitting of parton lin the parton shower approximation. We now need to deneMlfpfgm . This amplitude factors into a splitting op erator times the mparton matrix element evaluated at momenta and avors fpfgmde termined fromfpfgmaccording to the transformation Qlfpfgm Eq. . or Eq. . Mlfpfgm ty lflflfmVy lfpfgmMfpfgm . In Eq. .Vyfpfgm is the analogue of vfpgm but is now an operator on the spin part of the color spin space. There is also an operator ty lflflfm on the color part of the color spin space. This operator multiplies by the right color matrix. We will not comment further on it in this section but will turn to the description of color in Sec. . The spin dependent splitting operator can be described in terms of its matrix elements fsgmVy lfpfgmfsgm . This is a simple function of fpfgmfsgm andfsgm. Furthermore we can take it to be diagonal in the spectator spins fsgmVy lfpfgmfsgm Y jflmgsjsj Avlfpfgmsmslsl. Our object in this section is to dene the splitting functions vfrom the QCD vertices. In writing formulas for vlfpfgmsmslsl we will use the momentum pl. We under stand that this is obtained from fpfgmaccording to the transformation Qlfpfgm. . Initial state qq gsplitting quark scatters Figure Illustration of factorization at the amplitude level leading to the denition of the splitting function in Eq. .. When the nal state gluon becomes collinear with the initial state quark the full amplitude is approximately the amplitude for one fewer parton with the incoming quark after the gluon radiation approximated as being on shell times a splitting function simply made from the QCD qqgvertex and the singular quark propagator. If the nal state gluon is soft then this diagram is one of the possibilities. Then the soft gluon could have been emitted from any of the external legs of the diagram and we must sum over all of the possible emissions. In this case we can however use a simpler splitting function. Consider an initial state qqg splitting in which the gluon goes into the nal state and the quark enters the hard scattering as illustrated in Fig. . We highlight this case because it exhibits some complications compared to nal state qq g splitting. The parton that splits could be either of the initial state partons. We examine the case that it is parton a. The kinematics were dened in Secs. .and.. In order to keep our notation for this subsection as simple as possible we will write ppa a p pa a q pm m mfa mfa s sa pmsmQ. Hereis dened to be orthogonal to Q pa pb papb. The Feynman rules forMfpfgm give the following structure MHPm PmgtcUps . Here there are factors Ups for the initial state quark and for the nal state gluon. There is a vertex g with a color matrix tc. There is a propagator for the oshell quark that carries momentum P pq . The quark propagator has a denominator Pmand a numerator Pm. Finally there is the rest of the diagram H which contains hard interactions. Thus Hcarries a Dirac spinor index. We need to relate this toMfpfgm where the momenta and avors fpfgmas well as the splitting variables fpfgare given by the momentum and avor mappingQlfpfgm Eq. .. We will be concerned with the behavior of Min the soft and collinear limits. The soft limit isq for all four components of q. SincePmpq the denominator is proportional to a single power of q while the numerator stays nite in the q limit. To describe the collinear limit let qbe the part of qorthogonal to pAandpB. The collinear limit isq whileqpBstays nite. Also m withm.jq j. Then near the collinear limit the denominator is Pm q m Oq m . That is the denominator has two powers of q. To analyze the numerator we note that ppAOq m p pAOq m q pAqOq m. The numerator has a factor PmUps. Usingq and pmUps one can rewrite this factor in the form PmUps p q Ups q pm Ups. Looking at the numerator in this form we see that it vanishes in the collinear limit pro portionally to one power of qorm. ThusMis only half as singular in the collinear limit as it rst appears. We now develop an approximation for M. We can insert a factor next to Hin Eq. . so that it reads MHnpm pmn pnPm PmgtcUps . Herenis the lightlike vector npB. We now notice that the contribution from the rst term namely MnsHnpm pnPm PmgtcUps . can be neglected because it does not have a collinear or soft singularity. To see this takes a little analysis. First we write pP pqp . Since PmPm Pm we have MnsHn npgtaUps Hnpq p pnPm PmgtcUps . The rst term is nonsingular because the denominator is cancelled. In the second term the vector pqp vanishes in the collinear or soft limit. In the soft limit it is proportional to one power of q which cancels the single power of qin the denominator. In the collinear limit it is proportional to one power of q. As we have just seen the rest of the numerator contains an additional factor of q. Together these cancel the two powers of qfrom the denominator. Thus no singularity remains. We are left with MsingHpmn pnPm PmgtcUps . In Eq. . the factor pmis pmX sUpsUps . The factor Ups is to be associated with H giving the hard scattering amplitude for an incoming quark with spin s. The remaining factor Ups then becomes part of the splitting function. This calculation leads us to dene the splitting function as vaps pqm Upsn pqm Ups pn . This does not include the color matrix and a factor which will be included in the color operatorty lflflfm. As indicated by the derivation Eq. . is directly given by the factorized structure of QCD Feynman graphs in the soft and collinear limits. There is freedom to choose the form of the splitting function as one moves away from these limits. We have made a simple choice. In the hard part of the diagram we can make approximations that are valid for q . In particular we can adjust the momenta of the partons with indices other than a replacing pjbypjas dened by the momentum mapping Rafpfgmfpfg Eq. .. . Initial state qq gsplitting gluon scatters We consider next the process in which an initial state quark with label a splits to make a quark that goes into the nal state with label m and a gluon that enters the hard scattering with label a. We simplify the notation as in the previous subsection by using ppa a p pa a q pm m mfa mfm s sa s sm. The Feynman rules forMfpfgm give the following structure MHDPn PUqsgtc Ups . HereHis the hard part of the graph now with a vector index and there is a propagator for the oshell gluon that carries momentum P pq . We have chosen the axial gauge nA where nis the lightlike vector nPB. The numerator of the gluon propagator is DPn gPnnP Pn . As in the previous subsection Mis singular in the collinear limit in which q andm.As in the previous section the numerator is proportional to qand the denominator is proportional to q in the collinear limit. In order to nd a suitable approximation for M we insert next to H so that it reads MH Dpn pnnp pnDPn PUqsgtc Ups . We can drop the term pnnpnp. To see this we write pnnp pnPnnP PnDpnDPn . The termPngives zero when contracted with D. When we contract nPwithD we get nP PnDPn Pnn Pn . which does not have a collinear singularity. Finally the dierence DpnDPn is proportional to qin the collinear limit because Ppqin this limit. The remaining We do not need to be concerned with the soft limit q withm. Here there is only a pq singularity which is too weak to create a logarithmically divergent integration over nal states. Nevertheless our approximation to Malso matches the behavior of Min the soft limit. numerator factor gives another factor qin the collinear limit so that the factor q from the denominator is cancelled. Thus we are left with MMsing where MsingHDpnDPn PUqsgtc Ups . The factor Dpn is Dpn X spsnpsnX spsQpsQ . It is equivalent to use npBorQ pa pb papbto dene the polarization vectors since they are orthogonal to both ppaandpb. The factor psQ is to be associated withH giving the hard scattering amplitude for a gluon with spin s. The remaining factor psQ then becomes part of the splitting function. This calculation leads us to dene the splitting function as vaps pqpsQDpqnUqs Ups . This does not include the color matrix which is included in the color operator ty lfl flfm. In the hard part of the diagram we can again make approximations that are valid forq . In particular we can adjust the momenta of the partons with indices other than a replacing pjbypjas dened by the momentum mapping Rafpfgmfpfg Eq. .. We will also want to use Qpapbinstead of Q pa pbto dene the polarization vector for parton las it enters the hard scattering. This is just a change in notation rather than an approximation since Qis in thepQplane. . Other qqgsplittings For splittings involving a qqgvertex there are several other choices for the avors flfl and fmand for whether the index lof the parton that splits is a nal state index or an initial state index. The results for vlfpfgmsmslsl are listed in Table . In constructing this table we keep track of two sign factors. First there is a numerator sign that we compute as in the examples in the preceding subsections. This is a minus sign whenever a gluon or an antiquark enters the hard scattering from the initial state or leaves the hard scattering to the nal state and a plus sign when a quark enters or leaves the hard scattering. Second there is a color sign. There is always a color matrix ta. We count a color line entering the hard scattering as a color line leaving the hard scattering. Viewed this way the color matrix is actually taT. However the generator of color rotations for the representation of SU is taT. Thus we include taTas part of the color operator ty lflflfm and include the minus sign as part of the splitting function vl. This leaves a factor invlwhenever a line leaves the hard scattering. The sign included in ty lflflfm is indicated in the last column of Table . The net sign of vlis shown in the table. The construction for a nal state splitting as for an initial state splitting makes use of a lightlike vector nlthat is in the plane of pland Q pa pb which is the same as the plane ofplandQpapb. The normalization of nlis not signicant. Our choice for this vector was dened in Eq. .. . Splitting with a gggvertex We construct the splitting function for a g g g splitting in a similar fashion. In the case of a nal state splitting we use the ggg QCD vertex v papbpc gpapb g pbpcg pcpa . to dene vlfpfgmsmslsl ps pmplpmsmQplslQplslQ v pmplpmplD pl pmnl. For an initial state splitting we have vlfpfgmsmslsl ps pmplpmsmQplslQplslQ v pmplplpmD plpmnl. In each case we have the exact QCD vertex and the exact propagator for the oshell gluon innlA gauge followed by a projection onto the physical gluon degrees of freedom contained in the onshell polarization vector. . Soft splitting function These splitting functions enable us to approximate the m parton matrix element in the cases that pmis collinear with plor else pmis soft. In the special case that pmis soft or possibly soft and collinear with pl a simpler splitting function can be used. When pmis soft we have Mfpfgm X lMsoft lfpfgm . where Msoft lfpfgm ty lflflfmVysoft lfpfgmMfpfgm . The matrix elements of Vysoft lare specied by a function vsoft l fsgmVysoft lfpfgmfsgm Y jflmgsjsj Avsoft lfpfgmsmslsl . l flflfm vlpscolor F q q gpmsmQUplsl pl pmmflnlUplsl plnlpl pmmflta F qq gpmsmQVplslnl pl pmmfl Vplsl plnlpl pmmflta Iqq gpmsmQUplslnl pl pmmfl Uplsl plnlplpmmflta I q q gpmsmQVplsl pl pmmflnlVplsl plnlplpmmflta Fgq qplslQDpl pmnlUplsl Vpmsm pl pmta Ig q qplslQDplpmnlUpmsm Uplsl plpmta Igq qplslQDplpmnlVplsl Vpmsm plpmta I q gqplslQUpmsm pl pmmflnlVplsl plnlplpmmflta Iqg qplslQUplslnl pl pmmfl Vpmsm plnlplpmmflta Table Splitting functions vlfpfgmsmslsl for splittings involving a qqgvertex with a common factorpsremoved. The values of lare either in the set of initial state indices Ifabg or in the set of nal state indices Ffmg. The avors flfl and fmcan bef g or can be a quark index qfudg or an antiquark index qf udg. Recall from Eq. . that in the case of an initial state parton fland fldenote the opposite of the incoming avors of the parton. For a row in which qdenotes a quark index qdenotes the corresponding antiquark index. The next column gives the value of vlcorresponding to the values of lflfl and fmindicated. The last column indicates the sign of the color matrix that is incorporated into the color operator ty l. The lightlike vector nlis dened in Eq. .. If partonm is a quark or antiquark vsoft l . When parton m is a gluon vsoft lfpfgmsmslsl p sslslpmsmQpl pmpl . The functions vsoft lare not as powerful as the functions vlbecause they provide good approximations only in the soft gluon limit. Nevertheless we will have occasion to make use of them. . Description of color We will need a description of the quantum color state that is adapted to a description of shower evolution. If we use an index notation to each parton with label lthere is associated a color index al which takes values for a quark or antiquark and takes values for a gluon. There is also a spin index l which takes values for quark and for a gluon. We can expand Min terms of color and spin basis vectors in the form Mfpfgmaaabaam abmX fcgmfcgmaaabaamX fsgmfsgmabm Mfpfscgm. where the fcgm form a basis for the space of color singlet amplitudes with color labels fcgmand the fsgm form a basis for the spin space with spin labels fsgm. The quantities Mfpfscg are the expansion coecients. In a vector notation this is Mfpfgm csX fcgmfcgm c X fsgmfsgm sMfpfscgm . HereMfpfgm cslies in the combined colorspin space whilefcgm cis a vector in color space andfsgm sis a vector in spin space. As discussed in Sec. we use a conventional treatment of spin. We assume that the spin labels already represent parton helicities using suitable conventions for choosing corresponding Dirac spinors and polarization vectors. Then the basis vector labels can be simplyfsgmfsasbssmgand the basis vectors can be fsgmabmasabsbsmsm . Then we have an orthonormal basis fsgmfsgm is if the spin labels are all the same and zero otherwise. We use a treatment of color that is conventional but more subtle than the treatment for spin. We turn to this subject in this section. . Color basis We rst note that as far as color is concerned an initial state quark is equivalent to a nal state antiquark and an initial state antiquark is equivalent to a nal state quark. Thus in the prose description in this section we use quark and q to refer to a nal state quark or an initial state antiquark and we use antiquark and q to refer to a nal state antiquark or an initial state quark. Recall from Eq. . that in the case of an initial state parton fland fldenote the opposite of the incoming avors of the parton. We next note that the amplitudeMfpfgm us always invariant under an overall rotation of all of the parton colors. Thus what we really need is a basis for the space of color singlet amplitudes in the color space. There is a widely used and intuitively appealing way to do this that furthermore matches with the idea of color strings forming between outgoing partons . The color basis vectorsfcgm care labeled by a color string congurations fcgm. A color string conguration can be described as a set fSSngof one or more stringsS. There are two types of strings open strings andclosed strings . An open string is an ordered set of parton indices that we denote by S lllnln. Herelis the label of a quarklnis the label of an antiquark and llnare labels of gluons. A closed string is an ordered set of at least two parton indices that we denote by S lllnln. Here all of the indices label gluons and we treat sets that dier by a cyclic permutation of the indices as being the same. Thus a complete color string conguration for a quark an antiquark and ve gluons might be fg. This is a notation for a possible fcg. Now we can dene the basis states. We take fcgm to be a product fcgmaam SfagSfagSKfagK . Here we have denoted the set of color indices represented in string kby fagkfalalng . if stringkis lln or lln. Figure Illustration an open string color basis state left and a closed sting color basis state right. We can now dene the component factors VS. For notational convenience we sup pose thatliiso that the partons along the string are numbered sequentially n or n . We rst consider an open string as illustrated on the left in Fig. . We dene SfagnStatatanaan . where thetaare the SU generator matrices for the fundamental representation and we take theaanmatrix element of the matrix product of the generator matrices normalized toTR . The normalization factor nS is nS NcCn F . With this normalization SS X fagjSfagj . For a closed string with the same parton labels now all gluons we dene as illustrated on the right in Fig. SfagnSTr tatatan . where again the taare the SU generator matrices for the fundamental representation and where nS Cn F . With this normalization SS X fagjSfagj NcCFn . This is approximately in the limit of a large number of colors. A general color basis state is a product of string states.It includes a normalization factornfcgm nfcgm nSnSnSK . The normalization of the states is fcgmfcgm Y k SkSk . where the factors are given in Eqs. . and .. Thus fcgmfcgm in the large Nclimit. The basis vectorsfcgm are not exactly normalized and they are not orthogonal. However the inner product between two dierent basis vectors is small in the limit of a large number of colors fcgmfcgm ON cfcgmfcgm . For instance suppose fcgm and supposefcgm with the posi tions of the two gluons reversed. Then fcgmfcgm N c. The calculation is illustrated in Fig. . One could use the adjoint representation here. However an adjoint representation string is approx imately equivalent to two fundamental representation strings and having two strings when one would do makes the description more complicated. The building blocks used are the invariant matrices ijto connect a quark and an antiquark and ta ij to connect a quark antiquark and gluon. One could also use the completely antisymmetric matrix ijk to connect three quarks or three antiquarks. However we dont need states made using ijkbecause the amplitudes Mhave net baryon number zero. Figure Inner products for color basis states. The left hand picture illustrates the inner product of the with itself. The color diagram shown gives C FNc which is just canceled by the normalization factor nS from Eq. .. The right hand picture illustrates the inner product of the with . The color diagram gives CF. Multiplying by nS gives N c. . Parton insertion operators It will prove useful to dene certain operators that act on an mparton color state with partons with labels fabmgand add one parton with label m . We let ay l insert a gluon just to the right of parton lon whatever string contains parton l ay lfala ng falm ang ay lfala ng falm ang ay lflang flm ang ay lfal g . The rst equation applies to the case that llabels a gluon on an open string while the second equation applies to the case that llabels a gluon on an closed string. The third equation applies when llabels a quark at the end of an open string. The fourth equation applies when llabels an antiquark at the end of an open string. In this case there is no place to put the gluon so the result is dened to be zero. Similarly we dene an operator ay l that inserts a gluon just to the left of parton lon whatever string contains parton l ay lfala ng fam lang ay lfala ng fam lang ay lflang ay lfal g fam lg . We dene an operator ay ql that breaks a string at the position of a gluon with label l creating a quark that we take to inherit the label land an antiquark with the new label m . Iflis a gluon on an open string this creates two open strings. If lis a gluon on a closed string this turns the closed string into an open string. If llabels a quark or antiquark we dene the result to be zero. Thus ay qlfala ng fam lang ay qlfala ng flanam g ay qlflang ay qlfal g . Finally we dene an operator ay sl that removes a gluon with label lfrom its string and creates a new open string consisting of just a quark that we take to inherit the label land an antiquark with the new label m. Ifllabels a quark or antiquark we dene the result to be zero. Thus ay slfala ng faanlm ay slfala ng faanlm g ay slflang ay slfal g . We will see the utility of these operators presently when we study the color ow in parton splitting. . Color evolution for the quantum states In this subsection examine how the color vector changes with successive parton splittings. Consider starting with a color state formpartons and letting a nal state parton with labelland avorflemit a gluon with label m .After the gluon emission parton l retains its label land its avor. This produces a new color state ty lflfl g . We can dene the color splitting operator ty lflfl g precisely by writing this out in component notation aaabaalamamX alTflam alal aaabaalam . The matrix Tflamhere is the generator matrix in the representation if fl g in the representation if flfudg and in the representation if flf udg. This notation applies for an initial state splitting too since from Eq. . in the case of an initial state parton fland fldenote the opposite of the incoming avors of the parton. In this case the arrow in flfl g and more generally in flflfmrefers to backward evolution. In the nal state labels are called iandj. We identify iwithl andjwithm. The labels for the initialmpartons arefabmgand for the subsequent state after splitting are fabmm g. The partons not involved in the splitting keep their labels. Specically Tqa ijta ijTqa ijta jiandTga bcifbac whereqhere represents any quark avor and qrepresents any antiquark avor. Now consider what happens when the splitting operator is applied to one of the color basis vectorsfcgm . For the case that fl g we have X alTgam alaltalX alifalamaltaltaltamtamtal . Thusty lgg gfcgm is a normalization factor times a dierence of two basis vectors nfcgm nfcgmfcgm nfcgm nfcgmfcgm . Infcgm gluonlis replaced by gluons landm . Specically if in fcgmgluonl appears in an open string as ili n then infcgmthis string is replaced by ilm in and infcgmthis string is replaced by im lin. The normalization factor is nfcgm nfcgmCF . Analogous remarks apply for a closed string. We can state this result using the operators dened in Eqs. . and . ty lgg g p CFay lp CFay l . This is illustrated in Fig. . Figure Illustration of Eq. .. A gluon lspits into gluon land gluonm . The result is to place the new gluon m either to the right of gluon l with insertion operator ay l or to the left with insertion operator ay l. The normalization factorsp CFare not indicated. For a quark splitting to a quark plus a gluon we have a similar operator one more generator matrix is inserted at the quark end of the string so that ty lqq g p CFay l . For an antiquark splitting to an antiquark plus a gluon one more generator matrix is inserted at the antiquark end of the string so that ty lqq g p CFay l . In these equations qrepresents any quark avor and qrepresents any antiquark avor. The operators for gluon emission obey an important identity. The matrix element M and our approximations to it are always color singlets X lX alTflam alal aaabaalam . ThusX lty lflfl g . We will use this identity in the following sections to rearrange the splitting formulas. The last possibility for parton splitting is that of a gluon splitting into a quark antiquark pair with avors qand q. The color splitting operator is dened by ty lgq q . where aaabaamamX altalalam aaabaalam . Our convention here is that the quark inherits the gluon label l and the antiquark gets the new label m . To analyze this we use talalamtal cd camald Ncalamcd . Thustlgq qfcgm is a combination of two basis vectors nfcgm nfcgmfcgm Ncnfcgm nfcgmfcgm . Infcgm the string in which gluon lresides is split. Specically if in fcgm gluonl appears in an open string as iiAliBin then infcgmthis string is replaced by two strings iiAm liBin. On the other hand if in fcgm gluonl appears in a closed string as iiAliBin then infcgmthis string is replaced by an open string liBiniiAm . In either case nfcgm nfcgmNc CF . In the second color state in Eq. .fcgm gluonlis simply removed from its string and a new trivial qqstring is created. Specically if in fcgmgluonlappears in an open string as iiAliBin then infcgmthis string is replaced by two strings iiAiBin and lm . On the other hand if in fcgmgluonlappears in an closed string as iiAliBin then infcgmthis string is replaced by a closed string iiAiBin and the open string lm . In either case nfcgm nfcgmNc CF . We can state this result using the operators dened in Eqs. . and . ty lgq q r Nc CFay qlr NcCFay sl . We can now see the advantage of this choice of color basis beyond the fact that it is widely used for NLO calculations. In this basis the description of parton splitting is very simple. For splittings qqg and qqg we simply add a gluon to a string. For splittings ggg we replace one gluon on a string by two. There are two terms corresponding to the two possible orders for the two gluons on the string. For a splitting gqq we split a string or we remove the gluon from its string and create a new qqstring. The normalization factors may be considered to be just a matter of bookkeeping. However one should note that the splittings qqg qqg. and ggg come with numerical factorspCFin the amplitude. These factors are large for large Nc. The splitting g qqcomes with a numerical factor for the rst term NcCFthat is notlarge in the large Nclimit. The numerical factor for the second term is small in the large Nclimit. Thus the color factor for the splitting g qqis smaller than the color factors for the other splittings. This makes gqqsplitting somewhat disfavored even though there are several qq avor choices available. . Evolution for the statistical states We have seen how parton splitting works at the quantum amplitude level. We now need to use these results to formulate the eect of splitting on the density operator and thus the statistical state . Suppose that we have the function fpfscscgm . describingmnal state partons plus the two initial state partons. After one splitting we will havem nal state partons described by fpfscscgm . We need this function within the soft and collinear splitting approximations that we have used for the amplitudes. Any of the partons can split. In particular parton iinMfpfgm and parton jin Mfpfgmcan split. In the simplest case and the only case incorporated into typical parton shower Monte Carlo event generators ij. However one can have ijand still get the same momenta and avors fpfgmfrom both splittings and still get a logarithmic divergence if one were to integrate over fpgm. This happens when parton iemits a gluon m inMfpfgm and parton jemits gluon m in Mfpfgm. An interference graph of this sort has no collinear divergence from pmbeing collinear to pior pj. However it does have a soft divergence from pm. For this reason we need to include the case ij. For each splitting we relate fpfgmto the starting momenta and avors fpfgm and splitting variables fpfgusing one of the mappings fpfgmRlfpfgmfpfg . as specied in Sec. . In the case ij we can use either the mapping with lior the mapping with lj.We nd it most useful to average over these two possibilities. In the caseij we use the mapping with lij. We are thus led to write the density operator after splitting as a sum of contributions l ij where the superscript indicates the treatment of the kinematics and the subscripts indicate which partons split fpfgm X l l llfpfgm X kll lkfpfgm X kll klfpfgm . Here the sums run over the set fabmg. We use Eq. . for the contributions l ij in the case ij l llfpfgm ty lflflfmVy lfpfgmfpfgm Vlfpfgmtlflflfm Slffgm. HereSlffgm is a counting factor that is determined by the conventions we have used to label the nal state partons Slffgm lfmgflfm g lfmgfl gfm g lfmgfl gfm g lfmgflqfm q lfmgfl qfmq lfabg . This factor is zero for fl g and fmqorfm q even though avor conservation allows this combination in a qq g or qq g splitting because we have chosen to label the nal daughter gluon in these cases as parton m . Similarly this factor is zero for fl qand fmq even though avor conservation allows this combination in a gq qsplitting because we have chosen to label the nal daughter antiquark in this case as parton m . In the case of a nal state g g g splitting on line l the splitting probability is symmetric under interchange of the labels landm so that integrating over pland pmwould count the same physical conguration twice. The factor corrects for this symmetry. This issue is discussed in some detail in Appendix B. Either mapping suces because in either case the map becomes the identity map in the soft limit pm. Forij we can use the simpler splitting operator Vsoftas in Eq. . l ijfpfgm ty ifififmVysoft ifpfgmfpfgm Vsoft jfpfgmtjfjfjfm. Note thatVysoft i andVsoft jboth vanish if parton m is not a gluon. Thus l ij for ijunless parton m is a gluon. This denition for l ijdenes a mapping of the statistical states in which becomes l ij Sl ij . after splitting. Then fpfscscgmSl ij mZ dfpfscscgm fpfscscgmSl ijfpfscscgm fpfscscgm . The splitting operator Sl ijis dened by giving its matrix elements fpfscscgmSl ijfpfscscgm fccgmGijffgmfccgm fssgmWijffpgmfssgm fpfgmPlfpfgm m ncancbab ncancb abfaAa FfbBb F faAa FfbBb F. We discuss each factor in turn. The rst factorGijffgm describes how the splittings change the parton colors fccgmGijffgmfccgm D fcgmty ifififmfcgm fcgmtjfjfjfmfcgm D. In the next factor Wijffpgm contains the spindependent splitting functions. The simplest case occurs for ijwith anything other than a nal state g gg splitting. For that case fssgmWllffpgmfssgm Slffgm fsgmVy lfpfgmfsgm fsgmVlfpfgmfsgm Forijin general we dene fssgmWllffpgmfssgm Slffgm fsgmVy lfpfgmfsgm fsgmVlfpfgmfsgm lfmgflfm g fssgmfWllfpgmfssgm . The second term is included in the special case of a nal state g g g splitting. In this case the rst term is symmetric under an interchange lm between the two nal state gluons. It gives a leading singularity when gluon m is soft but also gives a leading singularity when gluon lis soft. We seek to use the freedom to assign labels to ensure that gluon m can be soft but not gluon l. The operator fWin the added term is antisymmetric under lm so that it gives zero contribution after integration over the nal state momenta. The simplest choice for fWwould be the rst term times pmQ plQ which is antisymmetric under lm. Then the total Wwould be just the rst term times pmQ plQ. Clearly this eliminates the singularity when gluon lis soft. However we adopt a slightly more subtle procedure. Write the tensor that denes the three gluon vertex as vvvv v papbpc gpapb v papbpc g pbpc v papbpc g pcpa. Then we can dene partial vertex functions analogous to those in Eq. . by vJlfpfgmsmslsl ps pmplpmsmQplslQplslQ v JpmplpmplD pl pmnl. forJfg. Finally we dene partial operators Vby the analogue of Eq. . fsgmVy Jlfpfgmfsgm Y jflmgsjsj AvJlfpfgmsmslsl. Now the rst term in Wcomes fromP JKvJv K. The term with a leading singularity when gluon m is soft is vv . The term with a leading singularity when gluon lis soft isvv . Therefore we need to get rid of vv and double vv to make up for the factor inSl. We thus dene fssgmfWllfpgmfssgm fsgmVy lfpfgmfsgm fsgmVlfpfgmfsgm fsgmVy lfpfgmfsgm fsgmVlfpfgmfsgm . This is computationally very simple even if it takes some time to explain. Forij we use the simpler splitting operators Vsoft fssgmWijffpgmfssgm fsgmVysoft ifpfgmfsgm fsgmVsoft jfpfgmfsgm . In the next factor the matrix element fpfgmPlfpfgm is a delta function that enforces the requirement that the momenta and avors fpfgmare related to the momenta and avors after the splitting by the mapping Ql. The denition is mZ dfpfgm fpfgmPlfpfgm h fpfgm h fpfgm . wherehfpfgm is an arbitrary test function and ffpfgmfpfggQlfpfgm . as specied in Sec. . Another useful identity for Plis m Z dfpfgm g fpfgm fpfgmPlfpfgm m X flflZ dpplfpgmfg fpfgm . whereg fpfgm is an arbitrary test function and fpfgmRlffpfgmfpfgg . is the inverse transformation to Ql as specied in Sec. . In this form we display an inte gration over the splitting variables that would occur in an implementation of this formalism as a computer program. The counting factor m is the ratio of the factor m in the normalization integral for fpfscscgmSl ij to the factor m in the normalization integral for fpfscscgm . This factor is derived in Appendix B. The factor with parton distri butions comes from Eqs. . and .. In the case of a nal state splitting this factor is . We can now assemble our result. From Eq. . we have S . where the total splitting operator is SX lSlSlSl ll X klSl lk X klSl kl . Here the sums run over the set fabmg. We manipulate the result a bit. Because the quantum amplitudes are color singlets as re ected in Eq. . when fm g the gluon emission operators Glkffgm obey X kGlkffgm X kGklffgm . To derive Eq. . from Eq. . we add one more integration to Eq. . in the formR dfpfgm g fpfgm . Then on the right hand side we change integration variables from fpfgm toffpfgmfpfggaccording to Eqs. . and .. This gives a result that is equivalent to Eq. .. Then theGlkffgm are not independent. For this reason there can be color coherence cancellations that are always present but are not evident if we use all of the possible Glkffgm operators. Accordingly when fm g we eliminate Gllffgm with the replacement Gllffgm X klGlkffgm X klGklffgm . We will see in Sec. how this allows cancellations to occur at a low level of a calculation. With this replacement the total splitting operator is given for the case fm g by fpfscscgmSlfpfscscgm m fpfgmPlfpfgmncancbab ncancb abfaAa FfbBb F faAa FfbBb F X kfabmg kl fccgmGlkffgmfccgm h fssgmWlkffpgmfssgm fssgmWllffpgmfssgmi fccgmGklffgmfccgm h fssgmWklffpgmfssgm fssgmWllffpgmfssgmi . In the case that fmg that isfflfmgfqqg this becomes fpfscscgmjSlfpfscscgm m fpfgmPlfpfgm ncancbab ncancb abfaAa FfbBb F faAa FfbBb F fccgmGllffgmfccgm fssgmWllffpgmfssgm . In the following section we will use Sto dene the splitting operator at shower time t HIt. Then in Sec. we will study the evolution of the color structure that is expressed in Eqs. . and .. In Sec. we will examine the how quantum coherence for soft gluon emission is contained in Eq. .. . The operator HIt It remains to dene the operator HIt. The integral of this operator over tgives the total probability for a splitting at any scale Z dtHIt S . To get the probability for a splitting at the scale corresponding to shower time t we simply need to insert a delta function that denes t. Our default choice is t logQ jpl lalbpmmflj . Here the virtuality is dened using pl pmfor a nal state splitting and plpmfor an initial state splitting. We take Q to be the hardness scale of the initial hard scattering that starts the parton shower so that the initial value of tis zero. One could take Q to be the minimum of the values pipjfor nal state particles ijfrom the initial hard scattering. Here we can neglect all quark masses compared to Q. Other denitions of t are possible. For instance many authors use a measure of the transverse momentum in a parton splitting. When we use the denition . oft we obtain the corresponding denition of HIt. fpfscscgmHItfpfscscgm X lfabmg fpfscscgmSlfpfscscgm tlogQ jpl lalbpmmflj . whereSlis dened in Eqs. . and .. In these equations there are parton distribu tion functions evaluated at a factorization scale F which we dene according to Eq. . in terms of t. In addition there is a factor s which needs to be evaluated at a scale R that has not been made explicit in the notation. The argument presented in Sec. . indicates that the momentum scale at the splitting is just the resolution scale that we use forF. Thus we take F RQ et . . Color evolution of the statistical states We are now in a position to say something about the color structure of the statistical states and the evolution of this structure. Notice that in general fpfscscgm can be nonzero forfcgmfcgm. Even if we start with fcgnfcgn at some early stage of evolution splitting will generate states with fcgmfcgmat later stages. However in the end we measure something that is color independent. This means taking the color trace of. That is we multiply fpfscscgm by fcgmfcgm and sum over the color congurations fcgmandfcgm as in Eq. .. Recall that when fcgmfcgm the inner product fcgmfcgm is of order N cto some power and is thus small in the large N climit and numerically small for Nc . Thus congurations with fcgmfcgmare not very important. Furthermore if we start with a state with fcgmfcgm splitting cannot generatefcgmfcgmat the next stage. Thus one can speak of a leading color approximation in which contributions with fcgmfcgmare always dropped. This is what happens in most parton shower Monte Carlo programs. We do not drop terms but we should understand what happens in the leading color approximation. In order to understand splitting in the leading color conguration suppose that we applyHIt to a statefpfscscgm in whichfcgfcg. Thus we consider the action of the color splitting operator Gijffgm on a statefccgm withfcgfcg fccgmGijffgmfccgm D fcgmty ifififmfcgm D fcgmty jfjfjfmfcgm. We rst consider gluon emission. That is fm g. Then after using Eq. . all of the contributions toHIt come fromGijffgm withij. In order to have a denite case in mind let us suppose that iandjare gluons. Then using Eq. . to represent the tyoperators in terms of the operators aythat insert the added gluon in particular places in the string basis states our matrix element becomes CF fcgmay ifcgm fcgmay jfcgm CF fcgmay ifcgm fcgmay jfcgm CF fcgmay ifcgm fcgmay jfcgm CF fcgmay ifcgm fcgmay jfcgm. Consider the case that gluon jis just to the right of gluon ialong a color string. Then if the new gluon is inserted to the right of gluon i we get the same state as when the new gluon is inserted to the left of gluon j. That is the third term with ay i anday j gives a nonzero matrix element when fcgmfcgm. This contribution is thus kept in the leading color approximation. The other three contributions would be thrown away in this approximation. This is illustrated in Fig. . i jm Figure Illustration of Eq. .. The rst diagram shows the color conguration corresponding to the operatorGijffgm the gluons color is emitted from parton iand absorbed on gluon j. Using Eq. . to write this in terms of color basis states one contribution is shown in the middle diagram. This is the leading color contribution. Another contribution is shown in the righthand diagram. This contribution is subleading. If iandjhad not been color connected to each other there would have been no contribution that survives in the leading color approximation. Similarly if gluon jis just to the left of gluon ialong a color string then the con tribution with ay i anday j makes a leading color contribution while the other three contributions would be thrown away in the leading color approximation. Suppose now that gluon jisnotnext to gluon ialong a color string. Then all four terms would be thrown away in the leading color approximation. We can summarize this by saying that there is a term that is kept in the leading color approximation when gluons iandjare color connected next to each other along a color string. An analogous analysis leads to the same conclusion if one or both of partons iand jare quarks. One may say that in the leading color approximation the operating units are color dipoles consisting of partons that are next to each other along a single color string. Within this approximation a gluon may be considered to carry the representation of SU instead of the representation. Then for instance the half of a gluon forms a dipole with the part of the neighboring gluon or with a neighboring quark. A dipole can emit a gluon. But there is no interference between diagrams in which the gluon is emitted by dierent dipoles. This is illustrated in Fig. . The color dipole picture was introduced as the basis of the parton shower program A RIADNE . With the formalism presented in this paper one Figure The starting diagram from Fig. in the leading color approximation in which gluons are emitted from color dipoles. The i jcolor dipole is a unit that emits a gluon and absorbs it on the other side of the diagram. At the next stage there will be an im color dipole and an m jcolor dipole.can easily implement this approximation but one can also keep corrections to it. We have considered gluon emission. The case of a gq qsplitting is rather dierent. Then the con tributing terms are from Gllffgm. For the op eratorsty lgq q in Eq. . we use Eq. .. In the leading term with operator ay ql the color string containing the gluon breaks at the position of the gluon with the creation of two new string ends. There is a second term with operator ay sl in which gluonlsimply disappears from its string and a new qqstring is created. However the coecient of ay sl is small in the Nc limit and would be dropped in the leading color approximation. In fact the coe cient of the leading ay ql is nite in the Nc limit instead of growing with Nc. Thus gq qsplitting is color suppressed compared to g g g splitting. Some of the color suppression is cancelled by the number of available qq avors. Parton shower Monte Carlo programs normally include the leading term in gq qsplitting. With the formalism presented in this paper we can keep both terms in g q qsplitting. . Soft gluon coherence When a soft gluon is emitted from the partons involved in a hard scattering the angular distribution of the emitted gluon re ects the structure of the emitting partons as a whole. In particular a soft gluon emitted from a pair of colored partons at an angle that is bigger than the angle between the partons eectively sees just one parton with the total color charge of the pair. Since the splitting operator HIt coherently sums the leading soft gluon singularities for emissions from a hard partonic system including all of the interference diagrams soft gluon coherence is automatically included. It is of interest to see how this happens and what form it takes in the color basis used in this paper. Consider the matrix element of the splitting operator Slfor the case fm g as given in Eq. .. There is a sum over indices k fabmgwithkl. There are two terms with dierent color factors fccgmGlkffgmfccgm and fccgmGklffgmfccgm . These have analogous structures so it suces to an alyze one of them. The coecient of the color factor fccgmGlkffgmfccgm is fssgmWtotlkffpgmfssgm fssgmWllffpgmfssgm fssgmWlkffpgmfssgm . The rst term is from the square of the amplitude for emitting the gluon from parton l. The second term represents the interference between the emission of gluon m from partonland the emission of this gluon from parton k. Let us evaluate this in the softgluon approximation VVsoft as dened in Eqs. . and .. We can also approximate plpland pkpk. With these replacements we have fssgmWtotlkffpgmfssgm Y jmsjsjs js j AspmsmQpl pmpl pmsmQpl pmplpmsmQpk pmpk . There are singularities when pmis collinear with pland when pmcollinear with pk. The singularity for pmcollinear with pkis not strong enough to give a logarithmic divergence when we integrate over the direction of pm. The singularity for pmcollinear with plis strong enough to give a logarithmic divergence. Here the leading singularity comes from the rst term while the second term representing the interference graph gives only an integrable collinear singularity. When pmis not close to being collinear with plorpk both terms are important. However suppose that the angle between plandpkis small and that pmmakes an angle with either of them that is substantially greater than this angle. Then the two contributions approximately cancel each other. That is soft gluon radiation associated with this color factor is approximately conned to a cone about the directions of partons landkwith opening angle on the order of the angle between plandpk. Thus there is approximate angular ordering of soft gluon emissions. One can also make an exact statement about angular ordering . If we sum over the spins of the soft gluon we can use X smpmsmQpmsmQgp mQQp m pmQQp mp m pmQ . Then we can integrate over the azimuthal angle specifying the rotation of pmaboutpl in the rest frame of Q. This gives Zd X smsmsmsm fssgmWtotlkffpgmfssgm Y jmsjsjs js j AsIsoft. where IsoftZd p l pmplp l pmplp k pmpk gp mQQp m pmQQp mp m pmQ . One can multiply this out and perform the integral using Zd AB ABcos jABj . This gives IsoftQpl plpmQpm pmpklp pmpkmfk pm mfl plpm . Hereis the velocity of parton l lp plQmflQ plQ . We have written vfor the product vof a vector vwith the tensor dened by Qp lp lQ Qpl . The tensor lis the unit antisymmetric tensor in the plQplane and projects onto this plane. It obeys l P whereP is the projection operator onto the plQ plane. In the case that all of the masses are zero Eq. . becomes IsoftQpl plpmQpm pmpkp pmpk masses vanish . The ratio in the rst term in Eq. . is either or. It is if pmQ pmplpkQ pkpl . That is the ratio is if in the rest frame of Q pmmakes a smaller angle with plthan doespk. In this small angle region we have IsoftQpl plpmQpmmasses vanish small angle . In the wide angle region where pmmakes a larger angle with plthan doespk we have Isoft masses vanish wide angle . Thus in the massless case after a sum over spins and an average over the azimuthal angle the soft radiation outside a cone centered on pland extending out to pkcancels exactly. This phenomenon is known as angular ordering. It can be used to dene the angular ordering approximation in which one simply neglects the radiation outside of this cone even for a xed set of spins and a xed azimuthal angle. This angular ordering approximation is commonly used in parton shower Monte Carlo event generators. With the formalism of this paper one can make this approximation if desired but it is not required. In the massive case it is no longer true that soft radiation outside a cone centered on pland extending out to pkcancels after integrating over the azimuthal angle. . Inclusive evolution As described in Sec. . the Sudakov exponent is constructed from the operator Vt. In turnVt is constructed from HItfpfscscgm which tells the total probability for the statefpfscscgm to split at time t. In this section we determine the structure of HItfpfscscgm . We know the matrix elements of HIt so we simply insert the completeness relation . for the basis states and use Eq. . for the inner product of with a basis state. Thus HItfpfscscgm m Z dfpfscscgm fsgmfsgm fcgmfcgm fpfscscgmHItfpfscscgm . We use Eq. . to expressHIt in terms of a sum of splitting operators Sland then use Eqs. . and . for the matrix elements of Sl. We encounter m Z dfpfgm fpfgmPlfpfgm m X flflZ dpplfpgmf. where we have used Eq. .. Thus we are really integrating over the splitting variables. Inside the integral and the sum over l the variablesfpfgmare determined from fpfgm and the splitting variables fffgby the transformation Rl Eqs. . and .. Then HItfpfscscgm X lX flflZ dpplfpgmf tlogQ jpl lalbpmmflj ncancbab ncancb abfaAa FfbBb F faAa FfbBb F fm g fcgmgllffgmfcgm fsgmwllffpgmfsgm fm gX kl fcgmglkffgmfcgm fsgmwlkffpgmwllffpgmfsgm fcgmgklffgmfcgm fsgmwklffpgmwllffpgmfsgm . Here the color dependent function is fcgmgijffgmfcgm X fccgm fcgmfcgm fccgmGijffgmfccgm. and the spin dependent function is fsgmwijffpgmfsgm X fssgm fsgmfsgm fssgmWijffpgmfssgm . Let us look at the color factor in Eq. . rst. Using the denition . of Glkffgm we have fcgmgijffgmfcgm X fccgm fcgmtjfjfjfmfcgm D fcgmfcgm D fcgmty ifififmfcgm . Then using the completeness relations . and . we nd fcgmgijffgmfcgm fcgmtjfjfjfmty ifififmfcgm . The operator tjty iis written as TjTiin the work of Catani and Seymour on the dipole subtraction scheme for nexttoleading order calculations . In that work there is a sum over nal states while in this paper we follow the evolution of the exclusive nal state that comes between the operators tjandty i. We get back to the inclusive case when we form HItfpfscscgm . The operators gijhave some simple properties. From the denition Eq. . we see that fcgmgijffgmfcgm fcgmgjiffgmfcgm . Furthermore when ij the operators are proportional to the unit operator fcgmgllffgmfcgm fcgmfcgm CFfflfmgfqggorfqgg CAfflfmgfggg TRfflfmgfqqg . The last of these cases occurs in Eq. .. Let us look next at the spin dependent factor in Eq. .. In order to do this we need to introduce the possibility of averaging over the azimuthal angle of parton splitting. For the splitting of parton l we dene the transverse part qof pmby pmaplbnlq . wherenlis the lightlike vector dened in Eq. . andqplqnl . We let be the angle of qas measured in any convenient coordinate system so thatR dmeans integrating over qat xedjqj. Thus integrating over is part of integrating over the splitting variables p. Consider rst the spin dependent factors for the case ij which arises from interfer ence diagrams. Using the denition . ofWijffpgm and the orthogonality of the spin basis vectors this is fsgmwijffpgmfsgm X fsgm fsgmVsoft jfpfgmfsgm fsgmVysoft ifpfgmfsgm . Using the denition . and . ofVsoft this is fsgmwijffpgmfsgm X fsgm mY nsnsnsnsn s pmsmQpi pmpipmsmQpj pmpj mY nsnsn sX smpmsmQpi pmpipmsmQpj pmpj fsgmfsgm sX smpmsmQpi pmpipmsmQpj pmpj. Notice that fsgmwijffpgmfsgm is proportional to a unit matrix fsgmfsgm in the spin indices and that it is symmetric under ij. The coecient of fsgmfsgm is a product of splitting functions vsoft iandvsoft j as dened in Eq. . summed over siand sjand averaged over siandsj. That is fsgmwijffpgmfsgm fsgmfsgm wijffpgm . wherewijis wijffpgm wjiffpgm X smX siX siX sjX sjvsoft jfpfgmsmsjsjvsoft ifpfgmsmsisi . Consider next the case ijlfmgwith fl g or with l a or b and any fl. Using the denition . ofWllffpgm and orthogonality for the spin basis vectors this is fsgmwllffpgmfsgm X fsgmSlffgm fsgmVlfpfgmfsgm fsgmVy lfpfgmfsgm . Using the denition of Vas given in Eq. . this is fsgmwllffpgmfsgm X fsgm Y nflmgsnsnsnsn Slffgm v lfpfgmsmsls lvlfpfgmsmslsl X smX sl Y nflmgsnsn Slffgm v lfpfgmsmsls lvlfpfgmsmslsl . This is proportional to the unit matrix in the spin indices sns nfor allnexcept possibly forsls l the indices that appear in the functions vl. However in Eq. . there is an integration over the azimuthal angle as part of the integration over p. Once we sum over the nal state spin indices slsmand integrate over the result is invariant under rotations about the plaxis in the rest frame of Q. Thus the result must vanish for sls l. In addition the parity invariance of the splitting vertices implies that the result is invariant under a re ection through a plane containing plQ and any vector transverse to pland Q. Under this transformation slslands ls l. Thus the result is proportional to sls l. The coecient of the sls lcan be obtained by setting s lsl summing over sl and multiplying by . Thus Zd fsgmwllffpgmfsgm Zd mY nsnsn X smX slX slSlffgm v lfpfgmsmslslvlfpfgmsmslsl fsgmfsgm Slffgm X smX slX slvlfpfgmsmslsl. In the last line we have not written the average over because once we have summed over all of the spins the result is independent of . For the special case ijlfmgwith fl g there is an extra term in the denition . ofWllffpgm. The extra term involving fWdened in Eq. . is built from some of the separate terms in the three gluon vertex. Their treatment is essentially the same as the treatment just given for the other vertex functions. The result forijlin general is Zd fsgmwllffpgmfsgm fsgmfsgm wllffpgm . where wllffpgm Slffgm X smX slX sl vlfpfgmsmslsl lfmgflfm g h jvlfpfgmsmslsljjvlfpfgmsmslslji . Herevlandvlare dened in Eq. .. We conclude that HItfpfscscgm has the form given in Eq. . HItfpfscscgm fsgmfsgm fcgmhtfpfgmfcgm . It is proportional to the unit matrix in spin but is not proportional to the unit matrix or even diagonal in color. The matrix fcgmhtfpfgmfcgm is fcgmhtfpfgmfcgm X lX flflZ dpplfpgmf tlogQ jpl lalbpmmflj ncancbab ncancb abfaAa FfbBb F faAa FfbBb F fm g fcgmfcgm TRwllffpgm fm gX kl fcgmglkffgmfcgm wlkffpgmwllffpgm . Here fcgmgijffgmfcgm is given in Eq. . whilewijffpgm forijis given in Eq. . andwllffpgm is given in Eq. . . The scales Fused in the parton distribution functions and Rused insare given by Eq. .. Inside the integral and the sum over l the variablesfpfgmare determined from fpfgmand the splitting variablesfpfgby the transformation Rl Eqs. . and .. Notice that the matrix fcgmhtfpfgmfcgm is not diagonal in color. However the matrix elements with fcgmfcgmare suppressed by powers of Nc. For the term with a factor fcgmfcgm this was already noted in Eq. .. To see this for the term involvingglk we should write the matrix element of glkin the form of Eq. . fcgmglkffgmfcgm X fccgmD fcgmty kfkfkfmfcgm fcgmfcgm D fcgmty lflflfmfcgm . The leading contribution for Nc comes whenfcgmfcgmand partons landkare color connected they lie next to each other on a string. As discussed in Sec. we can use the representations . . . and . for the operators ty landty kto see that the action of ty landty kcan producefcgmfcgm. Iffcgmfcgm then the action ofty landty kalways producesfcgmfcgm so that we get a color suppressed inner product fcgmfcgm . . End of the shower As the shower progresses toward smaller and smaller resolution scales Q et there must come a point at which the perturbative basis of the evolution equation is no longer valid. Then at some evolution time tf the shower evolution should be stopped. In the event that the resolution scale of the desired measurement function is larger than fQ etf whatever happens beyond that is not seen by the measurement. Then one could simply apply the measurement function calculating Ftf . Let us suppose that the measurement function does not see the spins or colors of the nal state partons. Then as in Eq. . we need Ftf X m mZ dfpfscscgm Ffpfgm fsgmfsgm fcgmfcgm fpfscscgmtf . It is signicant that although the possibility of fcgmfcgmis included in the shower evolution presented in this paper the matrix fcgmfcgm is almost diagonal with o diagonal matrix elements being suppressed by factors of N c. The situations with respect to spins and colors are dierent. In the end we must have fsgmfsgmexactly. However the spins get shued at each stage of shower evolution and there is no reason that a state withfsgmfsgmat an earlier stage of evolution cannot evolve into a state with fsgmfsgmat the end. On the other hand color dierences between fcgmandfcgm are a little like entropy. Once fcgmfcgmat an early stage of evolution we can never getfcgmfcgmat the end. For this reason the most important part of color evolution is the part that maintains fcgmfcgmthroughout. This is evolution in the leading color dipole approximation. Now what if we wish to use a measurement function with a resolution scale smaller than f. Then we need a model for what happens at smaller resolution scales or later and earlier proper times than given by x f. Our model should certainly include hadronization. We can easily extend the formalism presented here to encompass hadroniza tion. We have only to replace Eq. . by FUtftf . HereUtf represents a model for what happens after Monte Carlo time tf. It starts with partonic states fpfgmand for the nal state partons turns them into hadronic states each according to its own probability. Assuming that the hadronization model does not use color or spin information we could represent this as Ftf X m mZ dfpfscscgm fsgmfsgm fcgmfcgm FUtffpfgm fpfscscgmtf . Typically hadronization models douse color information. The color eld interacting with the outgoing partons is represented as a classical color string. The string then frag ments into hadrons. This applies directly in P YTHIA and in a dierent way in H ERWIG where the color strings fragment into color singlet parton clusters immediately. The formalism of this paper is set up with the color string picture in mind. The color states fcgmexactly map onto string congurations as explained in Sec. .. Thus for terms in Eq. . withfcgmfcgm one can usefcgmas the input toUtf. The string model does not tell us what to do with fcgmfcgm. A reasonable suggestion would be to use fcgmhalf the time and fcgmhalf the time. This could be represented as Ftf X m mZ dfpfscscgm fsgmfsgm fcgmfcgm h FUtffpfcgm FUtffpfcgmi fpfscscgmtf . If the hadronization model is based on strings one needs to do something with the string ends that connect to the initial state partons. Consider for example the case that the hard collision at scale fis a quarkquark collision and concentrate on one of the initial state quarks. From the point of view of backwards evolution from the scale Q this initial state quark appears as a color line. The initial state quark is part of a colorless hadron but the net color is carried by the spectator quarks from this hadron. Thus in a color string model the color strings from the hard interactions should connect to the spectator partons. Of course this is not a completely simple problem. In a realistic model the spectator partons from the two hadrons have many interactions with each other possibly followed by their own not very hard parton showers. After all of these interactions the spectator partons left over from a quarkquark collision must have color but its internal color state can be quite complicated. Modeling the spectator interactions is well beyond the scope of this paper but is addressed by Sj ostrand and Skands in Ref. . . Conclusions We have presented a formulation of parton showering for hadronhadron collisions. The prediction for a cross section corresponding to an observable Fis given by Ftf or one of the other formulas in Sec. depending on the treatment of hadronization which is not covered in this paper. The dynamics of the quantum densityt is given by the evolution operator Utt so thattf Utf where is determined from the hard matrix element that starts the shower. Thus the shower dynamics represented inUtt is based on factorization of soft and collinear singularities from hard scattering. The basic formula is Eq. . which we can rewrite as Utft Ntft Ztf tdUtf HIVSNt . HereHIt is a parton splitting operator as dened in the preceding sections and VSt rep resents a virtual interaction that interchanges colors. The operator Nt generates the standard sort of Sudakov exponential that gives the probability not to have an interaction between shower times tand. Eq. . has the proper form to conveniently generate a parton shower. Starting with a state at time t one would useNt to determine the time for a parton splitting or color rearrangement. Possibly there is no splitting before the cuto time tf as represented by the rst term. Otherwise the operators HI andVS give a new partonic state at time. Now we operate with Utf which is to say that we apply this procedure again. We oer here concluding remarks under several headings. Implementation. Equation . together with the formulas in Sec. and the deni tions given throughout this paper represents a certain approximation for the cross section F corresponding to a given observable F. When Eq. . is iterated the result is expressed in the form of certain integrals and sums. It will be a signicant challenge to nd ways to implement Eq. . in a manner that allows an ecient calculation of F. We expect that there is more than one way to attack this problem. The choice aects the eciency of calculation but not the result F. We leave implementation issues to later work. Evolution variable. We have chosen the evolution variable tto be proportional to the virtuality in the splitting. An alternative would be the transverse momentum in the splitting. The H ERWIG choice of the splitting angle does not work well with the formalism presented here since a parton emitted at a xed angle can be arbitrarily soft necessitating introducing the nal hardness cuto fat each splitting. Momentum mapping. It is not kinematically possible for an onshell parton to split into two onshell partons. However it is useful to approximate the mother parton as being exactly onshell in calculating the relatively hard scattering in which the mother parton participates. To make this approximation we need to take the needed momentum from somewhere else. Sometimes this is done by taking momentum from the mothers sister in the previous splitting. In the CataniSeymour subtraction scheme for doing nexttoleading order calculations there is a spectator parton that donates the required momentum . Rather than taking momentum from a single parton that might not have much to give we have chosen to take a little momentum from each nal state parton with each donating according to how much momentum it has. Note that we keep momentum in balance at each step rather than waiting until the end of the shower to make adjustments. Common evolution. In Eq. . each parton has a chance to split or interchange colors between shower times tandtdt. In the very simplest form of a parton shower each parton could evolve independently at least if one ignores momentum conservation and adjusts the momenta only at the end. Then the complete evolution of each parton l could be traced out without keeping track of the other partons. Eectively there could be a separate time tlfor each parton. However independent evolution could still be implemented using a common evolution variable t giving each parton its chance to split between times tandtdt. The physical distinction that characterizes independent evolution is that the evolution is independent if the various functions involved in the splitting of parton ldo not involve the states of the other partons. With the denitions of the operators used in Eq. . the use of a common shower time variable is required since each splitting changes the whole partonic state and aects the probabilities for other partons to split at later shower times. Other choices. Within Eq. . there are quite a number of other choices required. For instance the splitting functions must have a particular form in the limits of soft and collinear splittings. However away from these limits there is a certain freedom to choose. Where choices like this were needed we exercised the freedom to choose based mostly on conceptual simplicity. Other authors might choose dierently. Interference and angular ordering. In Eq. . quantum interference between emissions of a gluon from dierent partons is treated exactly in the soft gluon limit. Sup pression of wide angle emissions is a result. Typically parton shower generators make an angular ordering approximation to this result. Once one has an implementation of Eq. . it will be interesting to make the standard angular ordering approximation and see how good an approximation it is. Spin. Partons produced in a hard scattering carry spin which can aect the angular distribution of their subsequent splittings. Eq. . includes the full spin information. Typically parton shower generators average over spins thus discarding this information. Once one has an implementation of Eq. . it will be interesting to insert spin averages everywhere and see how good an approximation it is. Color. Partons produced in a hard scattering carry color which can aect the pattern of future splittings. The formalism presented here includes the full color information. Typi cally parton shower generators make use of a leading color approximation that amounts to taking the rst term in an expansion about Nc . Once one has an implementation of Eq. . it will be interesting to make the leading color approximation everywhere and see how good an approximation it is. Improvements needed. We leave for future work the question of how one could match the parton shower to the exact matrix elements for nscattering instead of simply starting with scattering. We also leave for future work the question of how one could do this at nexttoleading order. See however Ref. . More ambitiously we would like to extend the whole formalism including the splitting functions to nextto leading order. Current work by others on softcollinear eective theory may be helpful here . Masses. We gave included quark masses in our momentum mappings and splitting func tions. However there are a number of issues associated with masses that we do not address. Suppose that we start with a hard scattering at a scale Qthat is much larger than the mass of the bottom quark mb.Suppose additionally that we want to continue evolution Here we assume that the bottom quark is the heaviest quark counted as initial state parton. One could include production of top quarks but would not include the top quark as a constituent of the proton unless Qmt. down to a scale that is less than mb. Then we need a suitable variable avor number scheme. At the leading order used in this paper this is easy enough but at higher orders of perturbation theory there are some subtle issues. Collins has addressed some of these issues as they arise in deeply inelastic scattering. One should however note that for hadronhadron collisions the power suppressed terms that are omitted when the cross section is written in a factored form as a hard scattering function convoluted with parton distributions are not of order QCDQ but rather of order m bQ . This is not a problem since in the applications we have in mind m bQ . We lack a theorem to tell us what to do if we want to keep the hard scattering but lower the resolution scale to m bso as to examine the nal state in more detail. Foundations. The formalism presented here is based on ideas of factorization both at the amplitude level and at the cross section level where summation over partonic states that are unresolved at a given scale is essential. As the discussion of masses makes clear more work is needed to make these ideas suciently precise to justify the formalism. Acknowledgments We are grateful to J. Collins M. Seymour P. Skands and Z. Tr ocs anyi for helpful conver sations. This work was supported in part the United States Department of Energy and by the Swiss National Science Foundation SNF through grant no. and by the Hungarian Scientic Research Fund grants OTKA T. A. Limit on momentum fraction after splitting In Sec. . we dened the kinematics of initial state splitting. For a collinear splitting from an initial state parton say parton a we have a a. It is not exactly evident that this holds in away from the collinear limit especially with masses. Here we show that this holds under the kinematic conditions . and .. Let ga papb absmfa mfb mfamfb abs ga papb absmfa mfb mfamfb absA. Note that ga is an increasing function of its argument in the allowed region of momentum fractions bsdga da mfamfb abs A. since absm Hin our allowed kinematic region according to Eq. .. Since ga is an increasing function we just need to show that gaga. Recall that the kinematics requires ga Kpm ga KA. where KK. Thus gaga gaga gaga KpmKgaga Kpmmfm mfamfa mfb abs A. We need to show that the right hand side of Eq. A. is positive. If mfamfa this is evident. There is only one case in which mfamfa. That is when we have a qqgor qqgsplitting in which the quark or antiquark enters the nal state and the gluon enters the hard scattering. Then mfm mfa andmfa . In that case gaga Kpmmfamfb abs KpmmfaA. where we have used absmfb from Eq. .. The minimum value of Kpmoccurs whenpmis proportional to K. Then Kpmmfap K so gagamfa p Kmfa mfa q Q mfa A. This is positive as long as the condition . holds. We have seen that gaga A. Since ga is an increasing function of a this implies that aa. B. Counting factors for the density matrix In this appendix we organize the singular contributions to the density matrix starting with the quantum amplitudes dened to be symmetric in the labels of the nal state partons or antisymmetric in the case of identical fermions. Then we introduce the relabelings that dene our labeling scheme for parton splittings. This produces the counting factors Slffgm dened in Eq. .. The counting factors are related to our parton labeling choices which in turn related to the singularities of the amplitude in the limit in which masses can be neglected. The counting factors do not depend on parton masses. In order to keep our notation simple in this appendix we simply take all the parton masses to vanish. LetMfpfgm be the exact tree level matrix element for a nal state of m partons dened to be symmetric under the interchange of the labels for any two of the nal state partons or antisymmetric if the two partons are identical fermions. The matrix element may have a singularity when any of the dot products of two parton momenta pipj approaches zero. Let us dene approximate matrix elementsMfpfgmij that approximate the complete matrix element when pipj approaches zero. Here ifabg andjfm gorijfm gwithij . There is more than one way to do this. We can for instance use the method of Sec. . The approximate matrix elementsMfpfgmij thus dened should include a theta function jpipjj min fklgfijg fklgfjigjpkplj B. so thatMfpfgmij is not singular when pkplfor some other pair of partons approaches zero. Given the approximate matrix elements the complete matrix element can be written as Mfpfgm mX jMfpfgm aj mX jMfpfgm bj mX ij ijMfpfgmij B. The right hand side of Eq. B. approximates the complete matrix element in any of the singular limits. For our purposes it is convenient to dene Mfpfgmij Mfpfgmji B. forijfm gij . Then we can symmetrize the third term in Eq. B. Mfpfgm mX jMfpfgm aj mX jMfpfgm bj mX ij ijMfpfgmij B. Now we construct the density operator from fpfgm Mfpfgm Mfpfgm B. Imagine expanding bothMfpfgm and Mfpfgmaccording to Eq. B.. There are a number of terms with the general form constMfpfgmij Mfpfgmij B. Not all of these contributions have soft or collinear singularities strong enough to produce a logarithmic divergence if one were to integrate over the momenta fpgm. One contribution that does have a strong enough singularity comes when ijij fm gandiijjorijji. The sum of these contributions is mX ij ijMfpfgmij Mfpfgmij B. where we have used Eq. B.. Another contribution that has a strong enough singularity comes when ii a and jjfm gwithjj. Similarly we can have ii b andjjfm g withjj. The sum of these contributions is mX jMfpfgm aj Mfpfgm aj mX jMfpfgm bj Mfpfgm bjB. Another contribution that does have a strong enough singularity comes when ijij fm gandiijjor elsejjiior elseijjior elsejiij. These four cases are really the same with dierent labeling. Adding the contributions we have mX ij ijmX k kikjMfpfgmik Mfpfgmjk B. Here we have a leading singularity only if fk g. This is the interference between gluon emission from line iand gluon emission from line j. We can also have interference between gluon emission from an initial state line and gluon emission from a nal state line or between gluon emission from one of the initial state lines and gluon emission from the other. When we add all of these cases together and add them to the contribution in Eq. B. we get X ijfabm g ijmX k kikjMfpfgmik Mfpfgmjk B. There are no more combinations of ijijthat give leading singular contributions to . Thus the sum of the leading singular contributions is obtained by adding the contribu tions B. B. and B.. This formulation is ne for constructing an inverse shower starting from a state with many partons and combining partons to reach a hard scattering with fewer partons. In order to construct a shower starting from the hard scattering it is convenient to adopt a labeling convention in which fpfgm is not symmetric under interchanges of the parton labels. This is easy to do. Consider the contribution B.. Using the ijsymmetry of the matrix elements this is mX iMfpfgmim Mfpfgmim mX imX j jiMfpfgmij MfpfgmijB. We can now deliberately break the relabeling symmetry in the second term by interchanging the labelsjandm . That is we choose to label the daughter parton that here caries the labeljbym instead. Note that this changes fpfgm for any xed value offpfgm. However the result of integrating fpfgm against any measurement function which must be symmetric under label interchanges stays the same. After the interchange jm the sum over jin the second term simply becomes a factor m. This gives mX iMfpfgmim Mfpfgmim m mX iMfpfgmim Mfpfgmim B. This is m mX iMfpfgmim Mfpfgmim B. We now consider the possibilities for avors ffifmgcould befgggfgqgfgqgfqgg fqggfqqg andfqqg whereqstands for a quark avor qstands for an antiquark avor and aqtogether with a qstands for a quark avor and its corresponding antiquark avor. Thus we can insert a factor ffifmgfggg ffifmgfgqg ffifmgfgqg ffifmgfqgg ffifmgfqgg ffifmgfqqg ffifmgfqqg B. In the coecients of the fgqgandfgqgtheta functions we can further dene the labeling by interchanging the labels iandm so that m is the label for the gluon. In the fqqgterm we can further dene the labeling by interchanging the labels iandm so thatm is the label for the antiquark. With these label choices our contribution is m mX lSlffgmMfpfgmlm Mfpfgmlm B. where Slffgm lfmgflfm g lfmgfl gfm g lfmgfl gfm g lfmgflqfm q lfmgfl qfmq B. We thus derive the factor m and the factor for a nal state g g g splitting. Consider now the contribution B.. We can break the relabeling symmetry by inter changing the labels jandm . Then there are m equal terms giving m X lfabgSlffgmMfpfgmlm Mfpfgmlm B. where Slffgm lfabg B. Consider nally the interference diagrams Eq. B.. We separate this into several terms according to the values of iandj X ijfabg ijmX kMfpfgmik Mfpfgmjk X ifabgmX jmX k kjMfpfgmik Mfpfgmjk mX iX jfabgmX k kiMfpfgmik Mfpfgmjk X ifabgmX kMfpfgmik Mfpfgmm k B. X jfabgmX kMfpfgmm k Mfpfgmjk mX jmX k kjMfpfgmm k Mfpfgmjk mX imX k kiMfpfgmik Mfpfgmm k mX ij ijmX k kikjMfpfgmik Mfpfgmjk We relabel the indices treating each term separately. In each case we interchange k m . In the rst term this gives m equal terms from the sum over k. In the second and third terms this gives mequal terms from the sum over k. In the fourth through seventh terms each term in the sum over kremains as one term. Finally in the eighth term there are m equal terms from the sum over k. After relabeling we have m X ijfabg ijMfpfgmim Mfpfgmjm mX ifabgmX jMfpfgmim Mfpfgmjm mmX iX jfabgMfpfgmim Mfpfgmjm X ifabgmX kMfpfgmim Mfpfgmkm B. X jfabgmX kMfpfgmkm Mfpfgmjm mX jmX k kjMfpfgmkm Mfpfgmjm mX imX k kiMfpfgmim Mfpfgmkm mmX ij ijMfpfgmim Mfpfgmjm These terms can be combined after changing the names of some of the summation indices and added to the contributions B. and B. to give the revised density operator which we can call fpfgm m X lfabmgSlffgmMfpfgmlm Mfpfgmlm m mX lkfabmg lkMfpfgmlm Mfpfgmkm B. The rst line here contains the direct terms Eqs. B. and B. while the second line is the interference terms Eq. B.. 